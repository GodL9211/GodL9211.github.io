import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as i,c as r,a as n,b as e,e as s,f as t}from"./app-967d79b2.js";const c={},l=t('<h1 id="rest-framework专栏讲解-二十七-异常" tabindex="-1"><a class="header-anchor" href="#rest-framework专栏讲解-二十七-异常" aria-hidden="true">#</a> Rest-framework专栏讲解(二十七): 异常</h1><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录" aria-hidden="true">#</a> 目录</h2><ul><li><a href="#%E5%BC%82%E5%B8%B8">异常</a><ul><li><a href="#REST-framework-%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">REST framework 视图中的异常处理</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8">自定义异常</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">自定义异常处理</a></li></ul></li><li><a href="#API-%E5%8F%82%E8%80%83">API 参考</a><ul><li><a href="#APIException">APIException</a><ul><li><a href="#%E6%A3%80%E6%9F%A5-API-%E5%BC%82%E5%B8%B8">检查 API 异常</a></li></ul></li><li><a href="#ParseError">ParseError</a></li><li><a href="#AuthenticationFailed">AuthenticationFailed</a></li><li><a href="#NotAuthenticated">NotAuthenticated</a></li><li><a href="#PermissionDenied">PermissionDenied</a></li><li><a href="#NotFound">NotFound</a></li><li><a href="#MethodNotAllowed">MethodNotAllowed</a></li><li><a href="#NotAcceptable">NotAcceptable</a></li><li><a href="#UnsupportedMediaType">UnsupportedMediaType</a></li><li><a href="#Throttled">Throttled</a></li><li><a href="#ValidationError">ValidationError</a></li></ul></li></ul>',3),d={href:"http://www.django-rest-framework.org/api-guide/exceptions/",title:"官方原文链接",target:"_blank",rel:"noopener noreferrer"},u={id:"异常",tabindex:"-1"},k=n("a",{class:"header-anchor",href:"#异常","aria-hidden":"true"},"#",-1),h={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=%E5%BC%82%E5%B8%B8",title:"异常",target:"_blank",rel:"noopener noreferrer"},f={id:"rest-framework-视图中的异常处理",tabindex:"-1"},m=n("a",{class:"header-anchor",href:"#rest-framework-视图中的异常处理","aria-hidden":"true"},"#",-1),b={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=rest-framework-%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86",title:"REST framework 视图中的异常处理",target:"_blank",rel:"noopener noreferrer"},_=t(`<p>REST framework 的视图处理各种异常，并返回适当的错误响应。</p><p>需要处理的异常情况有：</p><ul><li>在 REST framework 内引发的 <code>APIException</code>的子类。</li><li>Django 的 <code>Http404</code> 异常。</li><li>Django 的 <code>PermissionDenied</code> 异常。</li></ul><p>在每种情况下，REST framework 都会返回一个带有适当状态码和内容类型的响应。响应的主体将包含有关错误性质的其他细节。</p><p>大多数错误响应将包含响应正文中的关键 <code>detail</code>。</p><p>例如，以下请求：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>DELETE http<span class="token punctuation">:</span><span class="token operator">//</span>api<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>foo<span class="token operator">/</span>bar HTTP<span class="token operator">/</span><span class="token number">1.1</span>
Accept<span class="token punctuation">:</span> application<span class="token operator">/</span>json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>可能会收到错误响应，指出在该资源上不允许使用 <code>DELETE</code> 方法：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">405</span> Method Not Allowed
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>json
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">42</span>

<span class="token punctuation">{</span><span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Method &#39;DELETE&#39; not allowed.&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证错误的处理方式稍有不同，但都是将字段名称作为响应中的关键字。如果验证错误不是特定于某个字段的，那么它将使用 “non_field_errors” 键，或者为 <code>NON_FIELD_ERRORS_KEY</code> setting 设置的字符串值。</p><p>示例验证错误可能如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">400</span> Bad Request
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>json
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">94</span>

<span class="token punctuation">{</span><span class="token string">&quot;amount&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;A valid integer is required.&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;This field may not be blank.&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义异常" tabindex="-1"><a class="header-anchor" href="#自定义异常" aria-hidden="true">#</a> 自定义异常</h2><p>这里对异常的定义主要的想法来自 <code>ValidationError</code>，统一异常返回的格式，方便前端统一处理类似异常。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># utils/custom_exception.py</span>

<span class="token keyword">class</span> <span class="token class-name">CustomException</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 自定义code</span>
    default_code <span class="token operator">=</span> <span class="token number">400</span>
    <span class="token comment"># 自定义 message</span>
    default_message <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            status_code<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">,</span>
            code<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            message<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>status <span class="token operator">=</span> status_code
        self<span class="token punctuation">.</span>code <span class="token operator">=</span> self<span class="token punctuation">.</span>default_code <span class="token keyword">if</span> code <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> code
        self<span class="token punctuation">.</span>message <span class="token operator">=</span> self<span class="token punctuation">.</span>default_message <span class="token keyword">if</span> message <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> message

        <span class="token keyword">if</span> data <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>code<span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>data <span class="token operator">=</span> data

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>message


<span class="token keyword">class</span> <span class="token class-name">ExecuteError</span><span class="token punctuation">(</span>CustomException<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;执行出错&quot;&quot;&quot;</span>
    default_code <span class="token operator">=</span> <span class="token number">500</span>
    default_message <span class="token operator">=</span> <span class="token string">&quot;执行出错&quot;</span>


<span class="token keyword">class</span> <span class="token class-name">UnKnowError</span><span class="token punctuation">(</span>CustomException<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;执行出错&quot;&quot;&quot;</span>
    default_code <span class="token operator">=</span> <span class="token number">500</span>
    default_message <span class="token operator">=</span> <span class="token string">&quot;未知出错&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,15),v={id:"自定义异常处理",tabindex:"-1"},g=n("a",{class:"header-anchor",href:"#自定义异常处理","aria-hidden":"true"},"#",-1),E={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86",title:"自定义异常处理",target:"_blank",rel:"noopener noreferrer"},x=t(`<p>你可以通过创建处理函数来实现自定义异常处理，该函数将 API 视图中引发的异常转换为响应对象。这使你可以控制 API 错误响应的样式。</p><p>该函数必须带有一对参数，第一个是要处理的异常，第二个是包含任何额外上下文（例如当前正在处理的视图）的字典。异常处理函数应该返回一个 <code>Response</code> 对象，或者如果无法处理异常，则返回 <code>None</code>。如果处理程序返回 <code>None</code>，那么异常将被重新抛出，Django 将返回一个标准的 HTTP 500 &#39;server error&#39; 响应。</p><p>例如，你可能希望确保所有错误响应都包含响应正文中的 HTTP 状态码，如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">405</span> Method Not Allowed
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>json
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">62</span>

<span class="token punctuation">{</span><span class="token string">&quot;status_code&quot;</span><span class="token punctuation">:</span> <span class="token number">405</span><span class="token punctuation">,</span> <span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Method &#39;DELETE&#39; not allowed.&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了改变响应的风格，你可以编写下面的自定义异常处理程序：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler

<span class="token keyword">def</span> <span class="token function">custom_exception_handler</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Call REST framework&#39;s default exception handler first,</span>
    <span class="token comment"># to get the standard error response.</span>
    <span class="token comment"># 这里对自定义的 CustomException 直接返回，保证系统其他异常不受影响</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> CustomException<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>data<span class="token operator">=</span>exc<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span>exc<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
    
    response <span class="token operator">=</span> exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span>

    <span class="token comment"># Now add the HTTP status code to the response.</span>
    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">&#39;status_code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>status_code

    <span class="token keyword">return</span> response
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>context 参数不被默认处理程序使用，但是如果异常处理程序需要更多信息，例如当前正在处理的视图（可以作为 <code>context[&#39;view&#39;]</code> 访问），则该参数可能很有用。</p><p>异常处理程序还必须使用 <code>EXCEPTION_HANDLER</code> setting key 在你的设置中进行配置。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;EXCEPTION_HANDLER&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;my_project.my_app.utils.custom_exception_handler&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果未指定，则 <code>&#39;EXCEPTION_HANDLER&#39;</code> setting 默认为由 REST framework 提供的标准异常处理程序：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;EXCEPTION_HANDLER&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;rest_framework.views.exception_handler&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请注意，异常处理程序只会根据由异常产生的响应调用。它不会用于视图直接返回的任何响应，例如在序列化验证失败时通用视图返回的 <code>HTTP_400_BAD_REQUEST</code> 响应。</p><hr>`,13),y={id:"api-参考",tabindex:"-1"},T=n("a",{class:"header-anchor",href:"#api-参考","aria-hidden":"true"},"#",-1),w={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=api-%E5%8F%82%E8%80%83",title:"API 参考",target:"_blank",rel:"noopener noreferrer"},q={id:"apiexception",tabindex:"-1"},P=n("a",{class:"header-anchor",href:"#apiexception","aria-hidden":"true"},"#",-1),A={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=apiexception",title:"APIException",target:"_blank",rel:"noopener noreferrer"},N=t(`<p><strong>签名:</strong> <code>APIException()</code></p><p>在 <code>APIView</code> 类或 <code>@api_view</code> 中引发的所有异常的基类。</p><p>要自定义异常，请继承 <code>APIException</code>，并在该类上设置 <code>.status_code</code>，<code>.default_detail</code> 和 <code>default_code</code> 属性。</p><p>例如，如果你的 API 依赖于可能无法访问的第三方服务，则可能需要为 &quot;503 Service Unavailable&quot; HTTP 响应码封装异常。你可以这样做：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> APIException

<span class="token keyword">class</span> <span class="token class-name">ServiceUnavailable</span><span class="token punctuation">(</span>APIException<span class="token punctuation">)</span><span class="token punctuation">:</span>
    status_code <span class="token operator">=</span> <span class="token number">503</span>
    default_detail <span class="token operator">=</span> <span class="token string">&#39;Service temporarily unavailable, try again later.&#39;</span>
    default_code <span class="token operator">=</span> <span class="token string">&#39;service_unavailable&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),C={id:"检查-api-异常",tabindex:"-1"},B=n("a",{class:"header-anchor",href:"#检查-api-异常","aria-hidden":"true"},"#",-1),F={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=%E6%A3%80%E6%9F%A5-api-%E5%BC%82%E5%B8%B8",title:"检查 API 异常",target:"_blank",rel:"noopener noreferrer"},z=t(`<p>有许多不同的属性可用于检查 API 异常的状态。你可以使用它们为你的项目构建自定义异常处理。</p><p>可用的属性和方法有：</p><ul><li><code>.detail</code> - 返回错误的文本描述。</li><li><code>.get_codes()</code> - 返回错误的代码标识符。</li><li><code>.get_full_details()</code> - 返回文本描述和代码标识符。</li></ul><p>在大多数情况下，错误详情将是一个简单的 item：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>
You do <span class="token keyword">not</span> have permission to perform this action<span class="token punctuation">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>get_codes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
permission_denied
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>get_full_details<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;You do not have permission to perform this action.&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;permission_denied&#39;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在验证错误的情况下，错误详情将是 item 列表或字典：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;This field is required.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;A valid integer is required.&quot;</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>get_codes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;required&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;invalid&quot;</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>exc<span class="token punctuation">.</span>get_full_details<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;This field is required.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;required&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;A valid integer is required.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;invalid&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),K={id:"parseerror",tabindex:"-1"},M=n("a",{class:"header-anchor",href:"#parseerror","aria-hidden":"true"},"#",-1),R={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=parseerror",title:"ParseError",target:"_blank",rel:"noopener noreferrer"},S=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"ParseError(detail=None, code=None)")],-1),I=n("p",null,[e("在访问 "),n("code",null,"request.data"),e(" 时包含格式错误的数据则会引发此异常。")],-1),H=n("p",null,'默认情况下，此异常会导致 HTTP 状态码 "400 Bad Request" 的响应。',-1),D={id:"authenticationfailed",tabindex:"-1"},W=n("a",{class:"header-anchor",href:"#authenticationfailed","aria-hidden":"true"},"#",-1),G={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=authenticationfailed",title:"AuthenticationFailed",target:"_blank",rel:"noopener noreferrer"},L=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"AuthenticationFailed(detail=None, code=None)")],-1),V=n("p",null,"当传入的请求包含不正确的身份验证时引发。",-1),U=n("p",null,'默认情况下，此异常会导致 HTTP 状态码 "401 Unauthenticated" 的响应，但也可能会导致 "403 Forbidden" 响应，具体取决于所使用的身份验证方案。',-1),j={id:"notauthenticated",tabindex:"-1"},O=n("a",{class:"header-anchor",href:"#notauthenticated","aria-hidden":"true"},"#",-1),X={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=notauthenticated",title:"NotAuthenticated",target:"_blank",rel:"noopener noreferrer"},Y=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"NotAuthenticated(detail=None, code=None)")],-1),Q=n("p",null,"当未经身份验证的请求未通过权限检查时引发。",-1),J=n("p",null,'默认情况下，此异常会导致 HTTP 状态码 "401 Unauthenticated" 的响应，但也可能会导致 "403 Forbidden" 响应，具体取决于所使用的身份验证方案。',-1),Z={id:"permissiondenied",tabindex:"-1"},$=n("a",{class:"header-anchor",href:"#permissiondenied","aria-hidden":"true"},"#",-1),nn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=permissiondenied",title:"PermissionDenied",target:"_blank",rel:"noopener noreferrer"},en=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"PermissionDenied(detail=None, code=None)")],-1),an=n("p",null,"当经过身份验证的请求未通过权限检查时引发。",-1),sn=n("p",null,'默认情况下，此异常会导致 HTTP 状态码 "403 Forbidden" 的响应。',-1),tn={id:"notfound",tabindex:"-1"},on=n("a",{class:"header-anchor",href:"#notfound","aria-hidden":"true"},"#",-1),pn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=notfound",title:"NotFound",target:"_blank",rel:"noopener noreferrer"},rn=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"NotFound(detail=None, code=None)")],-1),cn=n("p",null,[e("当资源不存在于给定的 URL 时引发。这个异常相当于标准的 "),n("code",null,"Http404"),e(" Django 异常。")],-1),ln=n("p",null,'默认情况下，此异常会导致 HTTP 状态码为 "404 Not Found" 的响应。',-1),dn={id:"methodnotallowed",tabindex:"-1"},un=n("a",{class:"header-anchor",href:"#methodnotallowed","aria-hidden":"true"},"#",-1),kn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=methodnotallowed",title:"MethodNotAllowed",target:"_blank",rel:"noopener noreferrer"},hn=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"MethodNotAllowed(method, detail=None, code=None)")],-1),fn=n("p",null,"当请求发生时，找不到视图上对应的处理方法时引发。",-1),mn=n("p",null,'默认情况下，此异常会导致 HTTP 状态码为 "405 Method Not Allowed" 的响应。',-1),bn={id:"notacceptable",tabindex:"-1"},_n=n("a",{class:"header-anchor",href:"#notacceptable","aria-hidden":"true"},"#",-1),vn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=notacceptable",title:"NotAcceptable",target:"_blank",rel:"noopener noreferrer"},gn=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"NotAcceptable(detail=None, code=None)")],-1),En=n("p",null,[e("当请求发生时，任何可用渲染器都不符合 "),n("code",null,"Accept"),e(" header 时引发。")],-1),xn=n("p",null,'默认情况下，此异常会导致 HTTP 状态码为 "406 Not Acceptable" 的响应。',-1),yn={id:"unsupportedmediatype",tabindex:"-1"},Tn=n("a",{class:"header-anchor",href:"#unsupportedmediatype","aria-hidden":"true"},"#",-1),wn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=unsupportedmediatype",title:"UnsupportedMediaType",target:"_blank",rel:"noopener noreferrer"},qn=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"UnsupportedMediaType(media_type, detail=None, code=None)")],-1),Pn=n("p",null,[e("如果在访问 "),n("code",null,"request.data"),e(" 时没有可以处理请求数据的内容类型的解析器，就会引发。")],-1),An=n("p",null,'默认情况下，此异常会导致 HTTP 状态码 "415 Unsupported Media Type" 的响应。',-1),Nn={id:"throttled",tabindex:"-1"},Cn=n("a",{class:"header-anchor",href:"#throttled","aria-hidden":"true"},"#",-1),Bn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=throttled",title:"Throttled",target:"_blank",rel:"noopener noreferrer"},Fn=n("p",null,[n("strong",null,"签名:"),e(),n("code",null,"Throttled(wait=None, detail=None, code=None)")],-1),zn=n("p",null,"传入的请求未通过限流检查时引发。",-1),Kn=n("p",null,'默认情况下，此异常会导致 HTTP 状态码 "429 Too Many Requests" 的响应。',-1),Mn={id:"validationerror",tabindex:"-1"},Rn=n("a",{class:"header-anchor",href:"#validationerror","aria-hidden":"true"},"#",-1),Sn={href:"http://wiznote-desktop/ks/note/view/79a579df-0e97-4971-8f60-86ed3beffd85/6b5a9fa5-2926-459a-8ce8-58cdb462d207/index.html?lang=zh-cn&readerType=common&isPersonalKb=1&canEdit=1&userGuid=79a579df-0e97-4971-8f60-86ed3beffd85&alias=godl9211&pSpacing=16&darkBgColor=transparent&darkTextColor=#f0f0f0&isFromWizClipper=1&xssNoFrame=1&themeMode=auto&resourcesPath=&frameKey=normal_note_6b5a9fa5-2926-459a-8ce8-58cdb462d207#/drf/exceptions?id=validationerror",title:"ValidationError",target:"_blank",rel:"noopener noreferrer"},In=t(`<p><strong>签名:</strong> <code>ValidationError(detail, code=None)</code></p><p><code>ValidationError</code> 异常与其他 <code>APIException</code> 类略有不同：</p><ul><li><code>detail</code> 参数是必需的，不是可选的。</li><li><code>detail</code> 参数可以是错误详情列表或字典，也可以是嵌套的数据结构。</li><li>按照惯例，你应该导入 serializers 模块并使用完全限定的 <code>ValidationError</code> 样式，以区别于 Django 内置的验证错误。例如： <code>raise serializers.ValidationError(&#39;This field must be an integer value.&#39;)</code></li></ul><p><code>ValidationError</code> 类应该用于序列化类和字段验证以及验证器类。使用 <code>raise_exception</code> 关键字参数调用 <code>serializer.is_valid</code> 时也会引发此问题：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通用视图使用 <code>raise_exception=True</code> 标志，意味着你可以在 API 中全局覆盖验证错误响应的样式。为此，请使用自定义异常处理程序，如上所述。</p><p>默认情况下，此异常会导致 HTTP 状态码 &quot;400 Bad Request&quot; 的响应。</p><hr>`,8);function Hn(Dn,Wn){const a=p("ExternalLinkIcon");return i(),r("div",null,[l,n("blockquote",null,[n("p",null,[n("a",d,[e("官方原文链接"),s(a)])])]),n("h1",u,[k,e(),n("a",h,[e("异常"),s(a)])]),n("h2",f,[m,e(),n("a",b,[e("REST framework 视图中的异常处理"),s(a)])]),_,n("h2",v,[g,e(),n("a",E,[e("自定义异常处理"),s(a)])]),x,n("h1",y,[T,e(),n("a",w,[e("API 参考"),s(a)])]),n("h2",q,[P,e(),n("a",A,[e("APIException"),s(a)])]),N,n("h4",C,[B,e(),n("a",F,[e("检查 API 异常"),s(a)])]),z,n("h2",K,[M,e(),n("a",R,[e("ParseError"),s(a)])]),S,I,H,n("h2",D,[W,e(),n("a",G,[e("AuthenticationFailed"),s(a)])]),L,V,U,n("h2",j,[O,e(),n("a",X,[e("NotAuthenticated"),s(a)])]),Y,Q,J,n("h2",Z,[$,e(),n("a",nn,[e("PermissionDenied"),s(a)])]),en,an,sn,n("h2",tn,[on,e(),n("a",pn,[e("NotFound"),s(a)])]),rn,cn,ln,n("h2",dn,[un,e(),n("a",kn,[e("MethodNotAllowed"),s(a)])]),hn,fn,mn,n("h2",bn,[_n,e(),n("a",vn,[e("NotAcceptable"),s(a)])]),gn,En,xn,n("h2",yn,[Tn,e(),n("a",wn,[e("UnsupportedMediaType"),s(a)])]),qn,Pn,An,n("h2",Nn,[Cn,e(),n("a",Bn,[e("Throttled"),s(a)])]),Fn,zn,Kn,n("h2",Mn,[Rn,e(),n("a",Sn,[e("ValidationError"),s(a)])]),In])}const Vn=o(c,[["render",Hn],["__file","Rest-framework专栏讲解(二十七)- 异常.html.vue"]]);export{Vn as default};
