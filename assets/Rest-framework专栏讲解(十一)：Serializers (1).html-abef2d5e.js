import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as c,c as l,a as n,b as s,e as a,w as r,f as t}from"./app-9976b6d0.js";const u={},d=t('<h1 id="rest-framework专栏讲解-十一-serializers-1" tabindex="-1"><a class="header-anchor" href="#rest-framework专栏讲解-十一-serializers-1" aria-hidden="true">#</a> Rest-framework专栏讲解(十一)：Serializers (1)</h1><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录" aria-hidden="true">#</a> 目录</h2><ul><li><a href="#Serializers">Serializers</a><ul><li><a href="#%E7%94%B3%E6%98%8E%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB">申明序列化类</a></li><li><a href="#%E5%86%8D%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90">再举个栗子</a></li><li><a href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E8%B1%A1">序列化对象</a></li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E8%B1%A1">反序列化对象</a></li><li><a href="#%E4%BF%9D%E5%AD%98%E5%AE%9E%E4%BE%8B">保存实例</a><ul><li><a href="#save%E5%B8%B8%E8%A7%84%E4%BF%9D%E5%AD%98">.save常规保存</a></li><li><a href="#%E5%B0%86%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E4%BC%A0%E9%80%92%E7%BB%99-save">将附加属性传递给 .save()</a></li><li><a href="#%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96-save">直接覆盖 .save()。</a></li></ul></li><li><a href="#%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE">验证数据</a><ul><li><a href="#%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E6%97%B6%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8">数据验证时抛出异常</a></li><li><a href="#%E5%AD%97%E6%AE%B5%E7%BA%A7%E9%AA%8C%E8%AF%81">字段级验证</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E7%BA%A7%E9%AA%8C%E8%AF%81">对象级验证:</a></li><li><a href="#%E9%AA%8C%E8%AF%81%E5%99%A8">验证器</a></li></ul></li><li><a href="#%E8%AE%BF%E9%97%AE%E5%AE%9E%E4%BE%8B%E5%92%8C%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE">访问实例和初始数据</a></li><li><a href="#%E9%83%A8%E5%88%86%E6%9B%B4%E6%96%B0">部分更新</a></li><li><a href="#%E5%A4%84%E7%90%86%E5%B5%8C%E5%A5%97%E5%AF%B9%E8%B1%A1">处理嵌套对象</a></li><li><a href="#%E5%8F%AF%E5%86%99%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA">可写嵌套表示</a><ul><li><a href="#%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-create-%E6%96%B9%E6%B3%95">为嵌套表示书写 .create() 方法</a></li><li><a href="#%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-update-%E6%96%B9%E6%B3%95">为嵌套表示书写 .update() 方法</a></li><li><a href="#%E5%9C%A8%E6%A8%A1%E5%9E%8B%E7%AE%A1%E7%90%86%E5%99%A8%E7%B1%BB%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E5%AE%9E%E4%BE%8B">在模型管理器类中保存相关的实例</a></li></ul></li><li><a href="#%E5%A4%84%E7%90%86%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1">处理多个对象</a><ul><li><a href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1">序列化多个对象</a></li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1">反序列化多个对象</a></li></ul></li><li><a href="#%E5%8C%85%E5%90%AB%E9%A2%9D%E5%A4%96%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87">包含额外的上下文</a></li></ul></li><li><a href="#ModelSerializer">ModelSerializer</a><ul><li><a href="#%E6%A3%80%E6%9F%A5-ModelSerializer">检查 ModelSerializer</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E8%A6%81%E5%8C%85%E5%90%AB%E7%9A%84%E5%AD%97%E6%AE%B5">指定要包含的字段</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E5%B5%8C%E5%A5%97%E5%BA%8F%E5%88%97%E5%8C%96">指定嵌套序列化</a></li><li><a href="#%E6%98%BE%E5%BC%8F%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5">显式指定字段</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E5%8F%AA%E8%AF%BB%E5%AD%97%E6%AE%B5">指定只读字段</a></li><li><a href="#%E5%85%B6%E4%BB%96%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0">其他关键字参数</a></li><li><a href="#%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5">关系字段</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84">自定义字段映射</a><ul><li><a href="#field_class-%E5%92%8C-field_kwargs-API">field_class 和 field_kwargs API</a></li></ul></li></ul></li><li><a href="#HyperlinkedModelSerializer">HyperlinkedModelSerializer</a><ul><li><a href="#%E7%BB%9D%E5%AF%B9%E5%92%8C%E7%9B%B8%E5%AF%B9-URL">绝对和相对 URL</a></li><li><a href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E8%B6%85%E9%93%BE%E6%8E%A5%E8%A7%86%E5%9B%BE">如何确定超链接视图</a></li><li><a href="#%E6%9B%B4%E6%94%B9-URL-%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0">更改 URL 字段名称</a></li></ul></li><li><a href="#ListSerializer">ListSerializer</a><ul><li><a href="#allow_empty">allow_empty</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-ListSerializer-%E8%A1%8C%E4%B8%BA">自定义 ListSerializer 行为</a><ul><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA">自定义多个对象的创建</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9B%B4%E6%96%B0">自定义多个对象的更新</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-ListSerializer-%E5%88%9D%E5%A7%8B%E5%8C%96">自定义 ListSerializer 初始化</a></li></ul></li></ul></li><li><a href="#BaseSerializer">BaseSerializer</a><ul><li><a href="#Read-only-BaseSerializer-%E7%B1%BB">Read-only BaseSerializer 类</a></li><li><a href="#Read-write-BaseSerializer-%E7%B1%BB">Read-write BaseSerializer 类</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E5%9F%BA%E7%B1%BB">创建新的基类</a></li></ul></li><li><a href="#Serializer-%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6">Serializer 使用进阶</a><ul><li><a href="#%E9%87%8D%E5%86%99%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%A1%8C%E4%B8%BA">重写序列化和反序列化行为</a></li><li><a href="#%E7%BB%A7%E6%89%BF%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB">继承序列化类</a></li><li><a href="#%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5">动态修改字段</a></li></ul></li></ul><hr>',4),k={href:"http://www.django-rest-framework.org/api-guide/serializers/",title:"官方原文链接",target:"_blank",rel:"noopener noreferrer"},v={id:"serializers",tabindex:"-1"},m=n("a",{class:"header-anchor",href:"#serializers","aria-hidden":"true"},"#",-1),b={href:"http://drf.jiuyou.info/#/drf/serializers?id=serializers",title:"Serializers",target:"_blank",rel:"noopener noreferrer"},h=t("<p>序列化器允许<code>将诸如查询集和模型实例之类的复杂数据转换为原生 Python 数据类型</code>，然后可以将它们轻松地呈现为 <code>JSON</code>，<code>XML</code> 或其他内容类型。序列化器还提供反序列化，在首次验证传入数据之后，可以将解析的数据转换回复杂类型。</p><p>REST framework 中的序列化类与 Django 的 <code>Form</code> 和 <code>ModelForm</code> 类非常相似。我们提供了一个 <code>Serializer</code> 类，它提供了一种强大的通用方法来控制响应的输出，以及一个 <code>ModelSerializer</code> 类，它为创建处理模型实例和查询集的序列化提供了有效的快捷方式。</p>",2),_={id:"申明序列化类",tabindex:"-1"},g=n("a",{class:"header-anchor",href:"#申明序列化类","aria-hidden":"true"},"#",-1),f={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E7%94%B3%E6%98%8E%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB",title:"申明序列化类",target:"_blank",rel:"noopener noreferrer"},E=t(`<p>首先创建一个简单的对象用于示例：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">,</span> content<span class="token punctuation">,</span> created<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email
        self<span class="token punctuation">.</span>content <span class="token operator">=</span> content
        self<span class="token punctuation">.</span>created <span class="token operator">=</span> created <span class="token keyword">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>

comment <span class="token operator">=</span> Comment<span class="token punctuation">(</span>email<span class="token operator">=</span><span class="token string">&#39;leila@example.com&#39;</span><span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">&#39;foo bar&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>声明一个序列化类，使用它来序列化和反序列化与 Comment 对象相对应的数据。<br> 声明一个序列化类看起来非常类似于声明一个表单：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers

<span class="token keyword">class</span> <span class="token class-name">CommentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="再举个栗子" tabindex="-1"><a class="header-anchor" href="#再举个栗子" aria-hidden="true">#</a> 再举个栗子</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token punctuation">,</span> settings

<span class="token comment"># User序列化器</span>
<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blog <span class="token operator">=</span> serializers<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># User类</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> blog<span class="token punctuation">,</span> created<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        self<span class="token punctuation">.</span>blog <span class="token operator">=</span> blog
        self<span class="token punctuation">.</span>created <span class="token operator">=</span> created <span class="token keyword">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
    settings<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token punctuation">)</span>

    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;MedusaSorcerer&#39;</span><span class="token punctuation">,</span> blog<span class="token operator">=</span><span class="token string">&#39;https://juejin.cn/user/2805609406139950&#39;</span><span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="序列化对象" tabindex="-1"><a class="header-anchor" href="#序列化对象" aria-hidden="true">#</a> 序列化对象</h3><p>现在可以使用 <code>CommentSerializer</code> 来序列化评论或评论列表。同样，使用 <code>Serializer</code> 类看起来很像使用 <code>Form</code> 类。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer <span class="token operator">=</span> CommentSerializer<span class="token punctuation">(</span>comment<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># {&#39;email&#39;: &#39;leila@example.com&#39;, &#39;content&#39;: &#39;foo bar&#39;, &#39;created&#39;: &#39;2016-01-27T15:17:10.375877&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时已经将模型实例转换为 Python 原生数据类型。为了完成序列化过程，将数据渲染为 <code>json</code>。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>renderers <span class="token keyword">import</span> JSONRenderer

json <span class="token operator">=</span> JSONRenderer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
json
<span class="token comment"># b&#39;{&quot;email&quot;:&quot;leila@example.com&quot;,&quot;content&quot;:&quot;foo bar&quot;,&quot;created&quot;:&quot;2016-01-27T15:17:10.375877&quot;}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样，现在可以使用 <code>UserSerializer</code>来序列化评论或评论列表。同样，使用 <code>Serializer</code> 类看起来很像使用 <code>Form</code> 类。</p><p>在上面的代码块中定义了一个用户序列化类, 此时又定义了一个仿造 <code>ORM</code> 的用户类, 并将 <code>User</code> 的实例对象 <code>user</code> 传递给序列化的 <code>data</code> 参数, 将可以生成一个序列化对象, 打印序列化对象的 <code>.data</code> 属性可以获得以下数据：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;MedusaSorcerer&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;blog&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;https://juejin.cn/user/2805609406139950&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;2020-08-10T09:58:35.754067&#39;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时已经将模型实例转换为 Python 原生数据类型。为了完成序列化过程，将数据渲染为 <code>json</code>：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token punctuation">,</span> settings


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blog <span class="token operator">=</span> serializers<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> blog<span class="token punctuation">,</span> created<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        self<span class="token punctuation">.</span>blog <span class="token operator">=</span> blog
        self<span class="token punctuation">.</span>created <span class="token operator">=</span> created <span class="token keyword">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
    settings<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>renderers <span class="token keyword">import</span> JSONRenderer

    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">&#39;MedusaSorcerer&#39;</span><span class="token punctuation">,</span> blog<span class="token operator">=</span><span class="token string">&#39;https://juejin.cn/user/2805609406139950&#39;</span><span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>JSONRenderer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意在使用脚本执行的时候调用 <code>settings.settings.configure()</code> 获取配置信息的位置</p></blockquote><p>运行完成你可以获得字符：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token string">b&#39;{&quot;username&quot;:&quot;MedusaSorcerer&quot;,&quot;blog&quot;:&quot;https://juejin.cn/user/2805609406139950&quot;,&quot;created&quot;:&quot;2020-08-10T10:03:36.741946&quot;}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="反序列化对象" tabindex="-1"><a class="header-anchor" href="#反序列化对象" aria-hidden="true">#</a> 反序列化对象</h3><p>反序列化是相似的。首先我们将一个流解析为 Python 原生数据类型...</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>six <span class="token keyword">import</span> BytesIO
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>parsers <span class="token keyword">import</span> JSONParser

stream <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span>json<span class="token punctuation">)</span>
data <span class="token operator">=</span> JSONParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>...然后我们将这些原生数据类型恢复成通过验证的数据字典。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer <span class="token operator">=</span> CommentSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># True</span>
serializer<span class="token punctuation">.</span>validated_data
<span class="token comment"># {&#39;content&#39;: &#39;foo bar&#39;, &#39;email&#39;: &#39;leila@example.com&#39;, &#39;created&#39;: datetime.datetime(2012, 08, 22, 16, 20, 09, 822243)}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样，可以对User类做反序列化：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> io

<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token punctuation">,</span> settings


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blog <span class="token operator">=</span> serializers<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> blog<span class="token punctuation">,</span> created<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        self<span class="token punctuation">.</span>blog <span class="token operator">=</span> blog
        self<span class="token punctuation">.</span>created <span class="token operator">=</span> created <span class="token keyword">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>
    settings<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>parsers <span class="token keyword">import</span> JSONParser

    json <span class="token operator">=</span> <span class="token string">b&#39;{&quot;username&quot;:&quot;MedusaSorcerer&quot;,&quot;blog&quot;:&quot;https://juejin.cn/user/2805609406139950&quot;,&quot;created&quot;:&quot;2020-08-10T10:03:36.741946&quot;}&#39;</span>
    stream <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>json<span class="token punctuation">)</span>
    data <span class="token operator">=</span> JSONParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>validated_data<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将保存的序列化数据反序列化一样可以实现, 注意的是在你反序列的时候需要执行 <code>.is_valid()</code> 来判断数据是否符合序列化类声明的对象约束, 如果返回的是 <code>False</code> 的话说明序列化对象不是符合声明对象的那样, 在返回 <code>True</code> 的时候就可以用 <code>serializer.validated_data</code> 获取序列化的数据：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>rderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;MedusaSorcerer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;blog&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://juejin.cn/user/2805609406139950&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&#39;created&#39;</span><span class="token punctuation">,</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">741946</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>那不符合约束的情况就可以用 <code>serializer.errors</code> 获取错误信息：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>AppRegistryNotReady<span class="token punctuation">:</span> The translation infrastructure cannot be initialized before the apps registry <span class="token keyword">is</span> ready<span class="token punctuation">.</span> Check that you don&#39;t make non<span class="token operator">-</span>lazy gettext calls at <span class="token keyword">import</span> time<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>事实上在开发中返回的错误信息是一个字典对象, key 是出现错误的字段字符串, value 是出现不符合约束的描述列表, 由于没有在 Django 项目中运行, 所以出现了一个报错信息(忽略)。</p><h3 id="保存实例" tabindex="-1"><a class="header-anchor" href="#保存实例" aria-hidden="true">#</a> 保存实例</h3><h4 id="save常规保存" tabindex="-1"><a class="header-anchor" href="#save常规保存" aria-hidden="true">#</a> .save常规保存</h4><p><code>comment</code></p><p>如果希望能够基于验证的数据返回完整的对象实例，则需要实现 <code>.create()</code> 和 <code>.update()</code> 方法中的一个或两个。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CommentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Comment<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance<span class="token punctuation">.</span>email <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>content <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;content&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>created <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;created&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>created<span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果对象实例与 Django 模型相对应，还需要<code>确保这些方法将对象保存到数据库</code>。如果 <code>Comment</code> 是一个 Django 模型，这些方法可能如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Comment<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>  <span class="token comment"># 提交保存至数据库表</span>

<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    instance<span class="token punctuation">.</span>email <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span>content <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;content&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span>created <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;created&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>created<span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 提交更新至数据库表</span>
    <span class="token keyword">return</span> instance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在，当反序列化数据时，我们可以调用 <code>.save() </code>根据验证的数据返回一个对象实例。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>comment <span class="token operator">=</span> serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>调用 <code>.save()</code> 将创建一个新实例或更新现有实例，具体取决于在<code>实例化序列化类时是否传递了现有实例</code>：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># .save() will create a new instance.</span>
serializer <span class="token operator">=</span> CommentSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>

<span class="token comment"># .save() will update the existing \`comment\` instance.</span>
serializer <span class="token operator">=</span> CommentSerializer<span class="token punctuation">(</span>comment<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>user</code></p><p>同样，对User对象的保存处理如下：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blog <span class="token operator">=</span> serializers<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> User<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance<span class="token punctuation">.</span>username <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>blog <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;blog&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>blog<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>created <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;created&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>created<span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> blog<span class="token punctuation">,</span> created<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        self<span class="token punctuation">.</span>blog <span class="token operator">=</span> blog
        self<span class="token punctuation">.</span>created <span class="token operator">=</span> created <span class="token keyword">or</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果对象实例与 Django 模型相对应，还需要确保这些方法<code>将对象保存到数据库</code>。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    blog <span class="token operator">=</span> serializers<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>  <span class="token comment"># 提交保存至数据库表</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance<span class="token punctuation">.</span>username <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>blog <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;blog&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>blog<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>created <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;created&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>created<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 提交更新至数据库表</span>
        <span class="token keyword">return</span> instance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>保存实例或者更新实例的 <code>save()</code> 方法, 主要是看你是否在创建实例序列化对象是否传递了对象：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># 没有传递实例对象, 所以这是新增: .save() will create a new instance.</span>
serializer <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>

<span class="token comment"># 传递了一个 user 对象, 所以这是更新了 user 对象的数据: .save() will update the existing \`comment\` instance.</span>
serializer <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>user<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>.create()</code> 和 <code>.update()</code> 方法都是<code>可选的</code>。您可以都不实现，或者实现其中的一个或两个，具体取决于你的序列化类的用例。</p>`,50),y={id:"将附加属性传递给-save",tabindex:"-1"},z=n("a",{class:"header-anchor",href:"#将附加属性传递给-save","aria-hidden":"true"},"#",-1),A={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%B0%86%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E4%BC%A0%E9%80%92%E7%BB%99-save",title:"将附加属性传递给 ",target:"_blank",rel:"noopener noreferrer"},B={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%B0%86%E9%99%84%E5%8A%A0%E5%B1%9E%E6%80%A7%E4%BC%A0%E9%80%92%E7%BB%99-save",title:".save()",target:"_blank",rel:"noopener noreferrer"},w=t(`<p>有时你会希望你的视图代码能够在保存实例的时候注入额外的数据。这些附加数据可能包含当前用户，当前时间或其他任何不属于请求数据的信息。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>owner<span class="token operator">=</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>调用 <code>.create()</code> 或 <code>.update()</code> 时，任何其他关键字参数都将包含在 <code>validated_data</code> 参数中。</p>`,3),S={id:"直接覆盖-save-。",tabindex:"-1"},F=n("a",{class:"header-anchor",href:"#直接覆盖-save-。","aria-hidden":"true"},"#",-1),x={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96-save%E3%80%82",title:"直接覆盖 ",target:"_blank",rel:"noopener noreferrer"},C={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96-save%E3%80%82",title:".save()",target:"_blank",rel:"noopener noreferrer"},q={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96-save%E3%80%82",title:"。",target:"_blank",rel:"noopener noreferrer"},j=t(`<p>在某些情况下，<code>.create()</code> 和 <code>.update()</code> 方法名称可能没有意义。例如，在 “联系人表单” 中，我们可能不会创建新实例，而是发送电子邮件或其他消息。</p><blockquote><p>在这些情况下，可以选择直接覆盖 <code>.save()</code>，因为它更具可读性和有意义性。</p></blockquote><p>举个栗子：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ContactForm</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        email <span class="token operator">=</span> self<span class="token punctuation">.</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">]</span>
        message <span class="token operator">=</span> self<span class="token punctuation">.</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">]</span>
        send_email<span class="token punctuation">(</span><span class="token keyword">from</span><span class="token operator">=</span>email<span class="token punctuation">,</span> message<span class="token operator">=</span>message<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>请注意，在上面的情况下，必须直接访问 <code>serializer.validated_data</code> 属性。</p></blockquote><h3 id="验证数据" tabindex="-1"><a class="header-anchor" href="#验证数据" aria-hidden="true">#</a> 验证数据</h3><p>在反序列化数据时，你总是需要在尝试访问验证数据之前调用 <code>is_valid()</code>，或者保存对象实例。如果发生任何验证错误，那么 <code>.errors</code> 属性将包含一个代表错误消息的字典。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer <span class="token operator">=</span> CommentSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;foobar&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;content&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;baz&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># False</span>
serializer<span class="token punctuation">.</span>errors
<span class="token comment"># {&#39;email&#39;: [u&#39;Enter a valid e-mail address.&#39;], &#39;created&#39;: [u&#39;This field is required.&#39;]}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>字典中的每个键都是字段名称，值是与该字段相对应的错误消息（字符串列表）。<code>non_field_errors</code> 键也可能存在，并会列出任何常规验证错误。可以使用 <code>NON_FIELD_ERRORS_KEY</code> （在 settings 文件中设置）来定制 <code>non_field_errors</code> 关键字的名称。</p><p>反序列化 item 列表时，错误将作为代表每个反序列化 item 的字典列表返回。</p>`,10),M={id:"数据验证时抛出异常",tabindex:"-1"},D=n("a",{class:"header-anchor",href:"#数据验证时抛出异常","aria-hidden":"true"},"#",-1),U={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E6%97%B6%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8",title:"数据验证时抛出异常",target:"_blank",rel:"noopener noreferrer"},T=t(`<p><code>.is_valid()</code> 方法带有一个可选的 <code>raise_exception</code> 标志，如果存在验证错误，将导致它引发 <code>serializers.ValidationError</code> 异常。</p><p><code>这些异常由 REST framework 提供的默认异常处理程序自动处理</code>，并且默认情况下将返回 <code>HTTP 400 Bad Request</code>。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># Return a 400 response if the data was invalid.</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,3),R={id:"字段级验证",tabindex:"-1"},L=n("a",{class:"header-anchor",href:"#字段级验证","aria-hidden":"true"},"#",-1),I={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%AD%97%E6%AE%B5%E7%BA%A7%E9%AA%8C%E8%AF%81",title:"字段级验证",target:"_blank",rel:"noopener noreferrer"},N=t(`<p>你可以通过向 <code>Serializer</code> 子类添加 <code>.validate_&lt;field_name&gt;</code> 方法来指定自定义字段级验证。这些与 Django 表单上的 <code>.clean_&lt;field_name&gt;</code> 方法类似。</p><p>这些方法只有一个参数，就是需要验证的字段值。</p><p>您的 <code>validate_&lt;field_name&gt;</code> 方法应返回验证值或引发 <code>serializers.ValidationError</code>。</p><p>例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers

<span class="token keyword">class</span> <span class="token class-name">BlogPostSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">validate_title</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        value这里对应的是传给title的值
        对 title 字段进行判断
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token string">&#39;medusa&#39;</span> <span class="token keyword">not</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&quot;Blog post is not about Medusa&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> value
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：如果你的序列化程序中声明的 <code>&lt;field_name&gt;</code> 参数为 <code>required = False</code> ，那么如果未包含该字段，则不会执行此验证步骤。</p></blockquote><h4 id="对象级验证" tabindex="-1"><a class="header-anchor" href="#对象级验证" aria-hidden="true">#</a> 对象级验证:</h4><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token keyword">class</span> <span class="token class-name">BlogPostSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    start <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    finish <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        data是一个传给序列化器的字典
        判断传递的 start 和 finish 参数是否符合大小逻辑
        &quot;&quot;&quot;</span>
        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">&#39;start&#39;</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> data<span class="token punctuation">[</span><span class="token string">&#39;finish&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&quot;finish must occur after start&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="验证器" tabindex="-1"><a class="header-anchor" href="#验证器" aria-hidden="true">#</a> 验证器</h4><p>序列化器上的各个字段可以包含验证器，方法是在字段实例上声明它们，例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token comment"># 自定义验证方法 </span>
<span class="token keyword">def</span> <span class="token function">multiple_of_ten</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> value <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&#39;Not a multiple of ten&#39;</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">GameRecord</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    score <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>validators<span class="token operator">=</span><span class="token punctuation">[</span>multiple_of_ten<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>序列化类还可以包含应用于<code>整个字段数据集的可重用验证器</code>。这些验证器是通过在内部的 <code>Meta</code> 类中声明它们来包含的，如下所示：：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>validators <span class="token keyword">import</span> UniqueTogetherValidator


<span class="token keyword">class</span> <span class="token class-name">EventSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    room_number <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        validators <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token comment"># 唯一性验证器</span>
            UniqueTogetherValidator<span class="token punctuation">(</span>
                queryset<span class="token operator">=</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;other&#39;</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问实例和初始数据" tabindex="-1"><a class="header-anchor" href="#访问实例和初始数据" aria-hidden="true">#</a> 访问实例和初始数据</h3><p>将初始对象或查询集传递给序列化类实例时，该对象将作为 <code>.instance</code> 提供。如果没有传递初始对象，则 <code>.instance</code> 属性将为 <code>None</code>。</p><p>将数据传递给序列化类实例时，未修改的数据将作为 <code>.initial_data</code> 提供。如果 data 关键字参数未被传递，那么 <code>.initial_data</code> 属性将不存在。</p><h3 id="部分更新" tabindex="-1"><a class="header-anchor" href="#部分更新" aria-hidden="true">#</a> 部分更新</h3><blockquote><p>默认情况下, 必须为所有声明的序列化字段传递对应的值, 否则序列化器会引发验证错误, 此时你可以使用 <code>partial</code> 参数来允许部分更新。</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token keyword">class</span> <span class="token class-name">UpdateSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    room_number <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>


UpdateSerializer<span class="token punctuation">(</span>user<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;room_number&#39;</span><span class="token punctuation">:</span> <span class="token number">101</span><span class="token punctuation">}</span><span class="token punctuation">,</span> partial<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19),P={id:"处理嵌套对象",tabindex:"-1"},H=n("a",{class:"header-anchor",href:"#处理嵌套对象","aria-hidden":"true"},"#",-1),O={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%A4%84%E7%90%86%E5%B5%8C%E5%A5%97%E5%AF%B9%E8%B1%A1",title:"处理嵌套对象",target:"_blank",rel:"noopener noreferrer"},V=t(`<p>如果一个序列化对象的属性是另一个序列化对象, 又要怎么处理？</p><p>前面的例子适用于处理只具有简单数据类型的对象，但有时还需要能够表示更复杂的对象，其中对象的某些属性可能不是简单的数据类型，如字符串，日期或整数。</p><p><code>Serializer</code> 类本身就是一种 <code>Field</code>，可以用来表示一个对象类型嵌套在另一个对象类型中的关系。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">CommentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># user是一个序列化对象</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果嵌套可以选择接受该 <code>None</code> 值，则应将 <code>required=False</code> 传递给嵌套序列化器：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CommentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果嵌套序列对象是多条数据构成, 则应将 <code>many=True</code> 传递给嵌套序列化：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CommentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    edits <span class="token operator">=</span> EditItemSerializer<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    created <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8),J={id:"可写嵌套表示",tabindex:"-1"},K=n("a",{class:"header-anchor",href:"#可写嵌套表示","aria-hidden":"true"},"#",-1),W={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%8F%AF%E5%86%99%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA",title:"可写嵌套表示",target:"_blank",rel:"noopener noreferrer"},G=t(`<p>在处理支持反序列化数据的嵌套表示时，嵌套对象的任何错误都将嵌套在嵌套对象的字段名称下。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer <span class="token operator">=</span> CommentSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;foobar&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;doe&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;content&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;baz&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># False, email和created无法通过验证</span>

<span class="token comment"># 输出错误数据</span>
serializer<span class="token punctuation">.</span>errors
<span class="token comment"># {&#39;user&#39;: {&#39;email&#39;: [&#39;Enter a valid e-mail address.&#39;]}, &#39;created&#39;: [&#39;This field is required.&#39;]}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样，<code>.validated_data</code> 属性将包含嵌套的数据结构。</p>`,3),Y={id:"为嵌套表示书写-create-方法",tabindex:"-1"},X=n("a",{class:"header-anchor",href:"#为嵌套表示书写-create-方法","aria-hidden":"true"},"#",-1),Q={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-create-%E6%96%B9%E6%B3%95",title:"为嵌套表示书写 ",target:"_blank",rel:"noopener noreferrer"},Z={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-create-%E6%96%B9%E6%B3%95",title:".create()",target:"_blank",rel:"noopener noreferrer"},$={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-create-%E6%96%B9%E6%B3%95",title:" 方法",target:"_blank",rel:"noopener noreferrer"},nn=t(`<blockquote><p>如果你支持可写嵌套表示，则<code>需要</code>编写处理保存多个对象的 <code>.create()</code> 或 <code>.update()</code> 方法。</p></blockquote><p>以下示例演示如何处理使用嵌套配置文件对象创建用户。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># _*_ Coding: UTF-8 _*_</span>
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    profile <span class="token operator">=</span> ProfileSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;profile&#39;</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        profile_data <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span>
        user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>
        Profile<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>user<span class="token operator">=</span>user<span class="token punctuation">,</span> <span class="token operator">**</span>profile_data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> user
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),sn={id:"为嵌套表示书写-update-方法",tabindex:"-1"},an=n("a",{class:"header-anchor",href:"#为嵌套表示书写-update-方法","aria-hidden":"true"},"#",-1),en={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-update-%E6%96%B9%E6%B3%95",title:"为嵌套表示书写 ",target:"_blank",rel:"noopener noreferrer"},tn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-update-%E6%96%B9%E6%B3%95",title:".update()",target:"_blank",rel:"noopener noreferrer"},pn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E4%B8%BA%E5%B5%8C%E5%A5%97%E8%A1%A8%E7%A4%BA%E4%B9%A6%E5%86%99-update-%E6%96%B9%E6%B3%95",title:" 方法",target:"_blank",rel:"noopener noreferrer"},on=t(`<p>对于更新，您需要仔细考虑如何处理关系更新。例如，如果关系的数据是 <code>None</code> 或没有提供，则应发生以下哪种情况？</p><ul><li>在数据库中将关系设置为 <code>NULL</code>。</li><li>删除关联的实例。</li><li>忽略数据并保持原样。</li><li>引发验证错误。</li></ul><p>以下是我们以前的 <code>UserSerializer</code> 类中的 <code>.update()</code> 方法的示例。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    profile_data <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span>
    <span class="token comment"># Unless the application properly enforces that this field is</span>
    <span class="token comment"># always set, the follow could raise a \`DoesNotExist\`, which</span>
    <span class="token comment"># would need to be handled.</span>
    profile <span class="token operator">=</span> instance<span class="token punctuation">.</span>profile

    instance<span class="token punctuation">.</span>username <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span>email <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
    instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    profile<span class="token punctuation">.</span>is_premium_member <span class="token operator">=</span> profile_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
        <span class="token string">&#39;is_premium_member&#39;</span><span class="token punctuation">,</span>
        profile<span class="token punctuation">.</span>is_premium_member
    <span class="token punctuation">)</span>
    profile<span class="token punctuation">.</span>has_support_contract <span class="token operator">=</span> profile_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
        <span class="token string">&#39;has_support_contract&#39;</span><span class="token punctuation">,</span>
        profile<span class="token punctuation">.</span>has_support_contract
    <span class="token punctuation">)</span>
    profile<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> instance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为嵌套创建和更新的行为可能不明确，并且可能需要相关模型之间的复杂依赖关系，所以 REST framework 3 要求你始终明确写入这些方法。</p><blockquote><p>默认的 <code>ModelSerializer</code> 的 <code>.create()</code>和 <code>.update()</code> 方法不包括对可写嵌套表示的支持。</p></blockquote>`,6),cn={href:"http://www.django-rest-framework.org/api-guide/serializers/#drf-writable-nested",title:"DRF Writable Nested",target:"_blank",rel:"noopener noreferrer"},ln={id:"在模型管理器类中保存相关的实例",tabindex:"-1"},rn=n("a",{class:"header-anchor",href:"#在模型管理器类中保存相关的实例","aria-hidden":"true"},"#",-1),un={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%9C%A8%E6%A8%A1%E5%9E%8B%E7%AE%A1%E7%90%86%E5%99%A8%E7%B1%BB%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9A%84%E5%AE%9E%E4%BE%8B",title:"在模型管理器类中保存相关的实例",target:"_blank",rel:"noopener noreferrer"},dn=t(`<blockquote><p>在序列化类中保存多个相关实例的另一种方法是编写自定义模型管理器类。</p></blockquote><p>例如，假设我们希望确保 <code>User</code> 实例和 <code>Profile</code> 实例始终作为一对创建。我们可能会编写一个类似下面的自定义管理器类：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UserManager</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> email<span class="token punctuation">,</span> is_premium_member<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> has_support_contract<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> email<span class="token operator">=</span>email<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        profile <span class="token operator">=</span> Profile<span class="token punctuation">(</span>
            user<span class="token operator">=</span>user<span class="token punctuation">,</span>
            is_premium_member<span class="token operator">=</span>is_premium_member<span class="token punctuation">,</span>
            has_support_contract<span class="token operator">=</span>has_support_contract
        <span class="token punctuation">)</span>
        profile<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> user
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此管理器类现在更好地封装了用户实例和配置文件实例始终在同一时间创建。现在可以重新编写序列化类上的 .create()方法，以使用新的管理类方法。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        username<span class="token operator">=</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        email<span class="token operator">=</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">]</span>
        is_premium_member<span class="token operator">=</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;profile&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;is_premium_member&#39;</span><span class="token punctuation">]</span>
        has_support_contract<span class="token operator">=</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;profile&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;has_support_contract&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),kn={id:"处理多个对象",tabindex:"-1"},vn=n("a",{class:"header-anchor",href:"#处理多个对象","aria-hidden":"true"},"#",-1),mn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%A4%84%E7%90%86%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1",title:"处理多个对象",target:"_blank",rel:"noopener noreferrer"},bn=t(`<p>Serializer 类还可以处理序列化或反序列化对象列表。</p><h4 id="序列化多个对象" tabindex="-1"><a class="header-anchor" href="#序列化多个对象" aria-hidden="true">#</a> 序列化多个对象</h4><p>要序列化查询集或对象列表而不是单个对象实例，在实例化序列化类时，应该传递 <code>many=True</code> 标志。然后，您可以传递要序列化的查询集或对象列表。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
serializer <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># [</span>
<span class="token comment">#     {&#39;id&#39;: 0, &#39;title&#39;: &#39;The electric kool-aid acid test&#39;, &#39;author&#39;: &#39;Tom Wolfe&#39;},</span>
<span class="token comment">#     {&#39;id&#39;: 1, &#39;title&#39;: &#39;If this is a man&#39;, &#39;author&#39;: &#39;Primo Levi&#39;},</span>
<span class="token comment">#     {&#39;id&#39;: 2, &#39;title&#39;: &#39;The wind-up bird chronicle&#39;, &#39;author&#39;: &#39;Haruki Murakami&#39;}</span>
<span class="token comment"># ]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),hn={id:"反序列化多个对象",tabindex:"-1"},_n=n("a",{class:"header-anchor",href:"#反序列化多个对象","aria-hidden":"true"},"#",-1),gn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1",title:"反序列化多个对象",target:"_blank",rel:"noopener noreferrer"},fn=n("p",null,"反序列化多个对象的默认行为是支持多个对象创建，但不支持多个对象更新。",-1),En={id:"包含额外的上下文",tabindex:"-1"},yn=n("a",{class:"header-anchor",href:"#包含额外的上下文","aria-hidden":"true"},"#",-1),zn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%8C%85%E5%90%AB%E9%A2%9D%E5%A4%96%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87",title:"包含额外的上下文",target:"_blank",rel:"noopener noreferrer"},An=t(`<p>除了被序列化的对象外，还有一些情况需要为序列化类提供额外的上下文。一种常见的情况是，如果你使用的是包含超链接关系的序列化类，则需要序列化类访问当前请求，以便它可以正确生成完全限定的URL。</p><p>在实例化序列化对象时，你可以通过传递上下文参数来提供任意附加上下文。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer <span class="token operator">=</span> AccountSerializer<span class="token punctuation">(</span>account<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">:</span> request<span class="token punctuation">}</span><span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data

<span class="token punctuation">{</span>
  <span class="token string">&#39;id&#39;</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> 
    <span class="token string">&#39;owner&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;denvercoder9&#39;</span><span class="token punctuation">,</span> 
    <span class="token string">&#39;created&#39;</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2013</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">09</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">678870</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token string">&#39;details&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;http://example.com/accounts/6/details&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过访问 <code>self.context</code> 属性，可以在任何序列化对象字段逻辑中使用上下文字典，例如自定义的 <code>.to_representation()</code> 方法。</p>`,4),Bn={id:"modelserializer",tabindex:"-1"},wn=n("a",{class:"header-anchor",href:"#modelserializer","aria-hidden":"true"},"#",-1),Sn={href:"http://drf.jiuyou.info/#/drf/serializers?id=modelserializer",title:"ModelSerializer",target:"_blank",rel:"noopener noreferrer"},Fn=t(`<p>通常你会想要序列化类紧密地映射到 Django 模型定义上。</p><p><code>ModelSerializer</code> 类提供了一个快捷方式，可让你自动创建一个 <code>Serializer</code> 类，其中的字段与模型类字段对应。</p><p><strong><code>ModelSerializer</code></strong>** 类与常规 <strong><strong><code>Serializer</code></strong></strong> 类相同，不同之处在于：**</p><ul><li>它会根据模型自动生成一组字段。</li><li>它会自动为序列化类生成验证器，例如 unique_together 验证器。</li><li>它包含 <code>.create()</code> 和 <code>.update()</code> 的简单默认实现。</li></ul><p>声明ModelSerializer如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认情况下，该类中的所有模型类字段将被映射为相应的序列化类字段。</p><p>任何关系（如模型上的外键）都将映射到 <code>PrimaryKeyRelatedField</code> 。除非在序列化关系文档中指定，否则默认不包括反向关系。</p>`,8),xn={id:"检查-modelserializer",tabindex:"-1"},Cn=n("a",{class:"header-anchor",href:"#检查-modelserializer","aria-hidden":"true"},"#",-1),qn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%A3%80%E6%9F%A5-modelserializer",title:"检查 ",target:"_blank",rel:"noopener noreferrer"},jn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%A3%80%E6%9F%A5-modelserializer",title:"ModelSerializer",target:"_blank",rel:"noopener noreferrer"},Mn=t(`<p>序列化类能够生成一个表示字符串，可以让你充分检查其字段的状态。在使用 <code>ModelSerializer</code> 进行工作时，这是特别有用的，你需要确定它为你自动创建了哪些字段和验证器。</p><p>为此，使用 <code>python manage.py shell</code> 进入 Django shell，然后导入序列化类，实例化它并打印对象表示形式...</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> myapp<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> AccountSerializer
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> serializer <span class="token operator">=</span> AccountSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>serializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
AccountSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;ID&#39;</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> CharField<span class="token punctuation">(</span>allow_blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    owner <span class="token operator">=</span> PrimaryKeyRelatedField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),Dn={id:"指定要包含的字段",tabindex:"-1"},Un=n("a",{class:"header-anchor",href:"#指定要包含的字段","aria-hidden":"true"},"#",-1),Tn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%8C%87%E5%AE%9A%E8%A6%81%E5%8C%85%E5%90%AB%E7%9A%84%E5%AD%97%E6%AE%B5",title:"指定要包含的字段",target:"_blank",rel:"noopener noreferrer"},Rn=t(`<p>如果你只希望在模型序列化程序中使用默认字段的子集，则可以使用 <code>fields</code> 或 <code>exclude</code> 选项来完成此操作，就像使用 <code>ModelForm</code> 一样。强烈建议你显式使用 <code>fields</code> 属性序列化的所有字段。这将使你不太可能在模型更改时无意中暴露数据。</p><p>举个栗子：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你还可以将 <code>fields</code> 属性设置为特殊值 <code>&#39;__all__&#39;</code>，以指示应该使用模型中的所有字段。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token string">&#39;__all__&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你可以将 <code>exclude</code> 属性设置为从序列化程序中排除的字段列表。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        exclude <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的示例中，如果 <code>Account</code> 模型有3个字段 <code>account_name</code>，<code>users</code> 和 <code>created</code>，则会导致字段 <code>account_name</code> 和 <code>created</code> 被序列化。</p><p><code>fields</code> 和 <code>exclude</code> 属性中的名称通常映射到模型类的模型字段。</p><p>或者<code>fields</code>选项中的名称可以映射成属性或方法。而不会变成模型类中的参数。</p><p>从版本 3.3.0 开始，必须提供其中一个属性 <code>fields</code> 或 <code>exclude</code>。</p>`,11),Ln={id:"指定嵌套序列化",tabindex:"-1"},In=n("a",{class:"header-anchor",href:"#指定嵌套序列化","aria-hidden":"true"},"#",-1),Nn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%8C%87%E5%AE%9A%E5%B5%8C%E5%A5%97%E5%BA%8F%E5%88%97%E5%8C%96",title:"指定嵌套序列化",target:"_blank",rel:"noopener noreferrer"},Pn=t(`<p>默认的 <code>ModelSerializer</code> 使用主键进行关联，但你也可以使用 <code>depth</code> 选项轻松生成嵌套表示（自关联）：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
        depth <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>depth</code> 选项应设置为一个整数值，该值指示在还原为平面表示之前应该遍历的关联的深度。</p><p>如果你想自定义序列化的方式，你需要自己定义字段。</p>`,4),Hn={id:"显式指定字段",tabindex:"-1"},On=n("a",{class:"header-anchor",href:"#显式指定字段","aria-hidden":"true"},"#",-1),Vn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%98%BE%E5%BC%8F%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5",title:"显式指定字段",target:"_blank",rel:"noopener noreferrer"},Jn=t(`<p>你可以将额外的字段添加到 <code>ModelSerializer</code>，或者通过在类上声明字段来覆盖默认字段，就像你对 <code>Serializer</code> 类所做的那样。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&#39;get_absolute_url&#39;</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># get_absolute_url可调用</span>
    groups <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>额外的字段可以对应于模型上的任何属性或可调用的字段。</p></blockquote>`,3),Kn={id:"指定只读字段",tabindex:"-1"},Wn=n("a",{class:"header-anchor",href:"#指定只读字段","aria-hidden":"true"},"#",-1),Gn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%8C%87%E5%AE%9A%E5%8F%AA%E8%AF%BB%E5%AD%97%E6%AE%B5",title:"指定只读字段",target:"_blank",rel:"noopener noreferrer"},Yn=t(`<p>你可能希望将多个字段指定为只读。不要显式给每个字段添加 <code>read_only = True</code>属性，你可以使用快捷方式 Meta 选项 <code>read_only_fields</code> 。</p><p>该选项应该是字段名称的列表或元组，声明如下：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
        read_only_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>含有 <code>editable = False</code>的模型字段，<code>AutoField</code> 字段默认设置为只读，并且不需要添加到 <code>read_only_fields</code> 选项。</p><blockquote><p><strong>注意</strong>： 有一种特殊情况，只读字段是模型级别的 <code>unique_together</code> 约束的一部分。在这种情况下，序列化类需要验证约束该字段，但也不能由用户编辑。</p></blockquote><blockquote><p>处理这个问题的正确方法是在序列化类中明确指定字段，同时提供 <code>read_only = True</code> 和 <code>default = ...</code> 关键字参数。</p></blockquote><blockquote><p>其中一个例子是与当前认证 <code>User</code> 的只读关系，它与另一个标识符是 <code>unique_together</code> 。在这种情况下，你会像这样声明用户字段：</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>user <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> default<span class="token operator">=</span>serializers<span class="token punctuation">.</span>CurrentUserDefault<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>关于验证以后还会再说</p></blockquote>`,9),Xn={id:"其他关键字参数",tabindex:"-1"},Qn=n("a",{class:"header-anchor",href:"#其他关键字参数","aria-hidden":"true"},"#",-1),Zn={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%85%B6%E4%BB%96%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0",title:"其他关键字参数",target:"_blank",rel:"noopener noreferrer"},$n=t(`<p>还有一个快捷方式允许你使用 <code>extra_kwargs</code> 选项在字段上指定任意附加关键字参数。与 <code>read_only_fields</code> 的情况一样，这意味着你不需要在序列化类中显式声明该字段。</p><p>该选项是一个字典，将字段名称映射到关键字参数字典。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CreateUserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span>
        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;write_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> User<span class="token punctuation">(</span>
            email<span class="token operator">=</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            username<span class="token operator">=</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>validated_data<span class="token punctuation">[</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> user
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),ns={id:"关系字段",tabindex:"-1"},ss=n("a",{class:"header-anchor",href:"#关系字段","aria-hidden":"true"},"#",-1),as={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5",title:"关系字段",target:"_blank",rel:"noopener noreferrer"},es=n("p",null,[s("序列化模型实例时，可以选择多种不同的方式来表示关系。"),n("code",null,"ModelSerializer"),s(" 的默认表示是使用相关实例的主键。")],-1),ts=n("p",null,"其他表示形式包括使用超链接序列化，序列化完整嵌套表示形式或使用自定义表示形式序列化。",-1),ps={id:"自定义字段映射",tabindex:"-1"},os=n("a",{class:"header-anchor",href:"#自定义字段映射","aria-hidden":"true"},"#",-1),is={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84",title:"自定义字段映射",target:"_blank",rel:"noopener noreferrer"},cs=t("<p>ModelSerializer 类还公开了一个可以覆盖的 API，以便在实例化序列化对象时更改序列化对象的字段。</p><p>通常，如果 <code>ModelSerializer</code> 没办法生成默认需要的字段，那么你应该将它们明确地添加到类中，或者直接使用常规的<code>Serializer</code> 类。但是，在某些情况下，你可能需要创建一个新的基类，以定义如何为给定模型创建序列化对象的字段。</p><p><strong><code>.serializer_field_mapping</code></strong></p><p>Django 模型类到 REST framework 序列化类的映射。你可以重写此映射来更改应该用于每个模型类的默认序列化类。</p><p><strong><code>.serializer_related_field</code></strong></p><p>该属性应该是序列化器字段类，默认情况下用于关系字段。</p><p>对于 <code>ModelSerializer</code>，它默认为 <code>PrimaryKeyRelatedField</code>。</p><p>对于 <code>HyperlinkedModelSerializer</code>，它默认为 <code>serializers.HyperlinkedRelatedField</code>。</p><p><strong><code>serializer_url_field</code></strong></p><p>序列化器字段类，应该用于序列化类中的任何 <code>url</code> 字段。</p><p>默认是 <code>serializers.HyperlinkedIdentityField</code> 。</p><p><strong><code>serializer_choice_field</code></strong></p><p>序列化器字段类，应该用于序列化程序中的任何选择字段。</p><p>默认是 <code>serializers.ChoiceField</code>。</p>",14),ls={id:"field-class-和-field-kwargs-api",tabindex:"-1"},rs=n("a",{class:"header-anchor",href:"#field-class-和-field-kwargs-api","aria-hidden":"true"},"#",-1),us={href:"http://drf.jiuyou.info/#/drf/serializers?id=field_class-%E5%92%8C-field_kwargs-api",title:"field_class 和 field_kwargs API",target:"_blank",rel:"noopener noreferrer"},ds=t("<p>调用以下方法来确定应该自动包含在序列化程序中的每个字段的类和关键字参数。这些方法都应返回两个元组 <code>(field_class, field_kwargs)</code>。</p><p><strong><code>.build_standard_field(self, field_name, model_field)</code></strong></p><p>调用以生成映射到标准模型字段的序列化器字段。</p><p>默认实现基于 <code>serializer_field_mapping</code> 属性返回序列化类。</p><p><strong><code>.build_relational_field(self, field_name, relation_info)</code></strong></p><p>调用以生成映射到关系模型字段的序列化器字段。</p><p>默认实现基于 <code>serializer_relational_field</code> 属性返回一个序列化类。</p><p><code>relation_info</code> 参数是一个命名元组，它包含 <code>model_field</code>，<code>related_model</code>，<code>to_many</code>和 <code>has_through_model</code> 属性。</p><p><strong><code>.build_nested_field(self, field_name, relation_info, nested_depth)</code></strong></p><p>当 <code>depth</code> 选项已设置时，调用以生成映射到关系模型字段的序列化程序字段。</p><p>默认实现动态创建一个基于 <code>ModelSerializer</code> 或 <code>HyperlinkedModelSerializer</code> 的嵌套序列化类。</p><p><code>nested_depth</code> 将是 <code>depth</code> 选项的值减 1。</p><p><code>relation_info</code> 参数是一个命名元组，它包含 <code>model_field</code>，<code>related_model</code>，<code>to_many</code>和 <code>has_through_model</code> 属性。</p><p><strong><code>.build_property_field(self, field_name, model_class)</code></strong></p><p>调用以生成映射到模型类上的属性或零参数方法的序列化器字段。</p><p>默认实现返回一个 <code>ReadOnlyField</code> 类。</p><p><strong><code>.build_url_field(self, field_name, model_class)</code></strong></p><p>被调用来为序列化器自己的 <code>url</code> 字段生成一个序列化器字段。</p><p>默认实现返回一个 <code>HyperlinkedIdentityField</code> 类。</p><p><strong><code>.build_unknown_field(self, field_name, model_class)</code></strong></p><p>当字段名称未映射到任何模型字段或模型属性时调用。默认实现会引发错误。但是子类可以自定义这种行为。</p>",21),ks={id:"hyperlinkedmodelserializer",tabindex:"-1"},vs=n("a",{class:"header-anchor",href:"#hyperlinkedmodelserializer","aria-hidden":"true"},"#",-1),ms={href:"http://drf.jiuyou.info/#/drf/serializers?id=hyperlinkedmodelserializer",title:"HyperlinkedModelSerializer",target:"_blank",rel:"noopener noreferrer"},bs=t(`<p><code>HyperlinkedModelSerializer</code> 类与 <code>ModelSerializer</code> 类相似，只不过它使用超链接来表示关系而不是主键。</p><p>默认情况下，序列化器将包含一个 <code>url</code> 字段而不是主键字段。</p><p>url 字段将使用 <code>HyperlinkedIdentityField</code> 序列化器字段来表示，并且模型上的任何关系都将使用 <code>HyperlinkedRelatedField</code> 序列化器字段来表示。</p><p>你可以通过将主键添加到 <code>fields</code> 选项来明确包含主键，例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),hs={id:"绝对和相对-url",tabindex:"-1"},_s=n("a",{class:"header-anchor",href:"#绝对和相对-url","aria-hidden":"true"},"#",-1),gs={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E7%BB%9D%E5%AF%B9%E5%92%8C%E7%9B%B8%E5%AF%B9-url",title:"绝对和相对 URL",target:"_blank",rel:"noopener noreferrer"},fs=t(`<p>在实例化 <code>HyperlinkedModelSerializer</code> 时，必须在序列化上下文中包含当前请求，例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>serializer <span class="token operator">=</span> AccountSerializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">:</span> request<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样做将确保超链接可以包含适当的主机名，以便生成完全限定的 URL，例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>http<span class="token punctuation">:</span><span class="token operator">//</span>api<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token operator">/</span>accounts<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>而不是相对的 URL，例如</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">/</span>accounts<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果你确实想要使用相对 URL，则应该在序列化上下文中显式传递 <code>{&#39;request&#39;：None}</code>。</p>`,7),Es={id:"如何确定超链接视图",tabindex:"-1"},ys=n("a",{class:"header-anchor",href:"#如何确定超链接视图","aria-hidden":"true"},"#",-1),zs={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E8%B6%85%E9%93%BE%E6%8E%A5%E8%A7%86%E5%9B%BE",title:"如何确定超链接视图",target:"_blank",rel:"noopener noreferrer"},As=t(`<p>需要确定哪些视图应该用于超链接到模型实例。</p><p>默认情况下，超链接预期对应于与样式 <code>&#39;{model_name}-detail&#39;</code> 匹配的视图名称，并通过 <code>pk</code> 关键字参数查找实例。</p><p>您可以使用 <code>extra_kwargs</code> 设置中的 <code>view_name</code> 和 <code>lookup_field</code> 选项覆盖 URL 字段视图名称和查找字段，如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;account_url&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;url&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;view_name&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;accounts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;lookup_field&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&#39;users&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;lookup_field&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者，可以显式设置序列化类中的字段。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> serializers<span class="token punctuation">.</span>HyperlinkedIdentityField<span class="token punctuation">(</span>
        view_name<span class="token operator">=</span><span class="token string">&#39;accounts&#39;</span><span class="token punctuation">,</span>
        lookup_field<span class="token operator">=</span><span class="token string">&#39;slug&#39;</span>
    <span class="token punctuation">)</span>
    users <span class="token operator">=</span> serializers<span class="token punctuation">.</span>HyperlinkedRelatedField<span class="token punctuation">(</span>
        view_name<span class="token operator">=</span><span class="token string">&#39;user-detail&#39;</span><span class="token punctuation">,</span>
        lookup_field<span class="token operator">=</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span>
        many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        read_only<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;account_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>提示：正确地匹配超链接和 URL conf 有时可能有点困难。打印 <code>HyperlinkedModelSerializer</code> 实例的 <code>repr</code> 是一种特别有用的方法，可以准确检查这些关系预期映射的 view name 和 lookup field。</p></blockquote>`,7),Bs={id:"更改-url-字段名称",tabindex:"-1"},ws=n("a",{class:"header-anchor",href:"#更改-url-字段名称","aria-hidden":"true"},"#",-1),Ss={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E6%9B%B4%E6%94%B9-url-%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0",title:"更改 URL 字段名称",target:"_blank",rel:"noopener noreferrer"},Fs=n("p",null,[s("URL 字段的名称默认为 'url'。可以使用 "),n("code",null,"URL_FIELD_NAME"),s(" （在 settings 文件）全局覆盖此设置。")],-1),xs={id:"listserializer",tabindex:"-1"},Cs=n("a",{class:"header-anchor",href:"#listserializer","aria-hidden":"true"},"#",-1),qs={href:"http://drf.jiuyou.info/#/drf/serializers?id=listserializer",title:"ListSerializer",target:"_blank",rel:"noopener noreferrer"},js=t("<p><code>ListSerializer</code> 类提供了一次序列化和验证多个对象的行为。你通常不需要直接使用 <code>ListSerializer</code>，而应该在实例化序列化类时简单地传递 <code>many=True</code>。</p><p>当一个序列化类被实例化并且 <code>many = True</code> 被传递时，一个 <code>ListSerializer</code> 实例将被创建。序列化类成为父级 <code>ListSerializer</code> 的子级</p><p>以下参数也可以传递给 <code>ListSerializer</code> 字段或传递了 <code>many = True</code> 的序列化类：</p>",3),Ms={id:"allow-empty",tabindex:"-1"},Ds=n("a",{class:"header-anchor",href:"#allow-empty","aria-hidden":"true"},"#",-1),Us={href:"http://drf.jiuyou.info/#/drf/serializers?id=allow_empty",title:"allow_empty",target:"_blank",rel:"noopener noreferrer"},Ts=n("p",null,[s("默认情况下为 "),n("code",null,"True"),s("，但如果要禁止将空列表作为有效输入，则可将其设置为 "),n("code",null,"False"),s("。")],-1),Rs={id:"自定义-listserializer-行为",tabindex:"-1"},Ls=n("a",{class:"header-anchor",href:"#自定义-listserializer-行为","aria-hidden":"true"},"#",-1),Is={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89-listserializer-%E8%A1%8C%E4%B8%BA",title:"自定义 ",target:"_blank",rel:"noopener noreferrer"},Ns={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89-listserializer-%E8%A1%8C%E4%B8%BA",title:"ListSerializer",target:"_blank",rel:"noopener noreferrer"},Ps={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89-listserializer-%E8%A1%8C%E4%B8%BA",title:" 行为",target:"_blank",rel:"noopener noreferrer"},Hs=t(`<p>有几种情况可能需要自定义 <code>ListSerializer</code> 行为。例如：</p><ul><li>希望提供对列表的特定验证，例如检查一个元素是否与列表中的另一个元素不冲突。</li><li>想要自定义多个对象的创建或更新行为。</li></ul><p>对于这些情况，可以通过使用序列化类的 <code>Meta</code> 类中的 <code>list_serializer_class</code> 选项来修改传递了 <code>many=True</code> 时使用的类。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CustomListSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ListSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">CustomSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        list_serializer_class <span class="token operator">=</span> CustomListSerializer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),Os={id:"自定义多个对象的创建",tabindex:"-1"},Vs=n("a",{class:"header-anchor",href:"#自定义多个对象的创建","aria-hidden":"true"},"#",-1),Js={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA",title:"自定义多个对象的创建",target:"_blank",rel:"noopener noreferrer"},Ks=t(`<p>创建多个对象的默认实现是简单地为列表中的每个 item 调用 <code>.create()</code>。如果要自定义此行为，则需要在传递 <code>many=True</code>时自定义 <code>ListSerializer</code> 类上的 <code>.create()</code>方法。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ListSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        books <span class="token operator">=</span> <span class="token punctuation">[</span>Book<span class="token punctuation">(</span><span class="token operator">**</span>item<span class="token punctuation">)</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> validated_data<span class="token punctuation">]</span>
        <span class="token keyword">return</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>books<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        list_serializer_class <span class="token operator">=</span> BookListSerializer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),Ws={id:"自定义多个对象的更新",tabindex:"-1"},Gs=n("a",{class:"header-anchor",href:"#自定义多个对象的更新","aria-hidden":"true"},"#",-1),Ys={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9B%B4%E6%96%B0",title:"自定义多个对象的更新",target:"_blank",rel:"noopener noreferrer"},Xs=t(`<p>默认情况下，<code>ListSerializer</code>类<code>不支持多对象更新</code>。这是因为插入和删除预期的行为是不明确的。</p><p><code>为了支持多对象更新，你需要重写 update 方法</code>。在编写你的多对象更新代码时，一定要记住以下几点：</p><ul><li>如何确定应该为数据列表中的每个 item 更新哪个实例？</li><li>插入应该如何处理？它们是无效的，还是创建新对象？</li><li>应该如何处理删除？它们是否暗示了对象删除，或者删除了一段关系？它们应该被忽略，还是无效？</li><li>如何处理排序？改变两个 item 的位置是否意味着状态的改变或者被忽略？</li></ul><p>你需要为实例序列化类添加一个显式 <code>id</code> 字段。默认的隐式生成的 <code>id</code> 字段被标记为 <code>read_only</code>。这会导致它在更新时被删除。一旦你明确声明它，它将在列表序列化类的更新方法中可用。</p><p>下面是你如何选择实现多对象更新的示例:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ListSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Maps for id-&gt;instance and id-&gt;data item.</span>
        book_mapping <span class="token operator">=</span> <span class="token punctuation">{</span>book<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">:</span> book <span class="token keyword">for</span> book <span class="token keyword">in</span> instance<span class="token punctuation">}</span>
        data_mapping <span class="token operator">=</span> <span class="token punctuation">{</span>item<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span> item <span class="token keyword">for</span> item <span class="token keyword">in</span> validated_data<span class="token punctuation">}</span>

        <span class="token comment"># Perform creations and updates.</span>
        ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> book_id<span class="token punctuation">,</span> data <span class="token keyword">in</span> data_mapping<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            book <span class="token operator">=</span> book_mapping<span class="token punctuation">.</span>get<span class="token punctuation">(</span>book_id<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> book <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                ret<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>child<span class="token punctuation">.</span>create<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                ret<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>child<span class="token punctuation">.</span>update<span class="token punctuation">(</span>book<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Perform deletions.</span>
        <span class="token keyword">for</span> book_id<span class="token punctuation">,</span> book <span class="token keyword">in</span> book_mapping<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> book_id <span class="token keyword">not</span> <span class="token keyword">in</span> data_mapping<span class="token punctuation">:</span>
                book<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> ret

<span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># We need to identify elements in the list using their primary key,</span>
    <span class="token comment"># so use a writable field here, rather than the default which would be read-only.</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        list_serializer_class <span class="token operator">=</span> BookListSerializer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),Qs={id:"自定义-listserializer-初始化",tabindex:"-1"},Zs=n("a",{class:"header-anchor",href:"#自定义-listserializer-初始化","aria-hidden":"true"},"#",-1),$s={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E8%87%AA%E5%AE%9A%E4%B9%89-listserializer-%E5%88%9D%E5%A7%8B%E5%8C%96",title:"自定义 ListSerializer 初始化",target:"_blank",rel:"noopener noreferrer"},na=t(`<p>当具有 <code>many=True</code>的序列化类实例化时，我们需要确定哪些参数和关键字参数应该传递给子级 <code>Serializer</code>类和父级 <code>ListSerializer</code> 类的 <code>.__ init __()</code> 方法。</p><p>默认的实现是将所有参数传递给两个类，除了 <code>validators</code> 和任何自定义关键字参数，这两个参数都假定用于子序列化类。</p><p>有时你可能需要明确指定在传递 <code>many=True</code> 时如何实例化子类和父类。您可以使用 <code>many_init</code> 类方法来完成此操作。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">many_init</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Instantiate the child serializer.</span>
        kwargs<span class="token punctuation">[</span><span class="token string">&#39;child&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># Instantiate the parent list serializer.</span>
        <span class="token keyword">return</span> CustomListSerializer<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),sa={id:"baseserializer",tabindex:"-1"},aa=n("a",{class:"header-anchor",href:"#baseserializer","aria-hidden":"true"},"#",-1),ea={href:"http://drf.jiuyou.info/#/drf/serializers?id=baseserializer",title:"BaseSerializer",target:"_blank",rel:"noopener noreferrer"},ta=t("<p><code>BaseSerializer</code> 类可以用来方便地支持其他序列化和反序列化风格。</p><p>这个类实现了与 <code>Serializer</code> 类相同的基本 API：</p><ul><li><code>.data</code> - 返回传出的原始表示。</li><li><code>.is_valid()</code> - 反序列化并验证传入的数据。</li><li><code>.validated_data</code> - 返回验证的传入数据。</li><li><code>.errors</code> - 在验证期间返回错误。</li><li><code>.save()</code> - 将验证的数据保存到对象实例中。</li></ul><p>有四种方法可以被覆盖，这取决于你希望序列化类支持的功能：</p><ul><li><code>.to_representation()</code> - 重写此操作以支持序列化，用于读取操作。</li><li><code>.to_internal_value()</code> - 重写此操作以支持反序列化，以用于写入操作。</li><li><code>.create() 和 .update()</code> - 覆盖其中一个或两个以支持保存实例。</li></ul><p>因为这个类提供了与 <code>Serializer</code> 类相同的接口，所以你可以像现有的常规 <code>Serializer</code>或 <code>ModelSerializer</code> 一样，将它与基于类的通用视图一起使用。</p><p>唯一不同的是，<code>BaseSerializer</code> 类不会在可浏览的 API 中生成 HTML 表单。这是因为它们返回的数据不包含所有的字段信息，这些字段信息允许将每个字段渲染为合适的 HTML 输入。</p>",7),pa={id:"read-only-baseserializer-类",tabindex:"-1"},oa=n("a",{class:"header-anchor",href:"#read-only-baseserializer-类","aria-hidden":"true"},"#",-1),ia={href:"http://drf.jiuyou.info/#/drf/serializers?id=read-only-baseserializer-%E7%B1%BB",title:"Read-only ",target:"_blank",rel:"noopener noreferrer"},ca={href:"http://drf.jiuyou.info/#/drf/serializers?id=read-only-baseserializer-%E7%B1%BB",title:"BaseSerializer",target:"_blank",rel:"noopener noreferrer"},la={href:"http://drf.jiuyou.info/#/drf/serializers?id=read-only-baseserializer-%E7%B1%BB",title:" 类",target:"_blank",rel:"noopener noreferrer"},ra=t(`<p>要使用 <code>BaseSerializer</code> 类实现只读序列化类，我们只需重写 <code>.to_representation()</code> 方法。让我们来看一个使用简单的 Django 模型的示例：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HighScore</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    player_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    score <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建用于将 <code>HighScore</code> 实例转换为基本数据类型的只读序列化类非常简单。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HighScoreSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>BaseSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;score&#39;</span><span class="token punctuation">:</span> obj<span class="token punctuation">.</span>score<span class="token punctuation">,</span>
            <span class="token string">&#39;player_name&#39;</span><span class="token punctuation">:</span> obj<span class="token punctuation">.</span>player_name
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们现在可以使用这个类来序列化单个 <code>HighScore</code> 实例：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">high_score</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
    instance <span class="token operator">=</span> HighScore<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> HighScoreSerializer<span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者用它来序列化多个实例：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">all_high_scores</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> HighScore<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&#39;-score&#39;</span><span class="token punctuation">)</span>
    serializer <span class="token operator">=</span> HighScoreSerializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8),ua={id:"read-write-baseserializer-类",tabindex:"-1"},da=n("a",{class:"header-anchor",href:"#read-write-baseserializer-类","aria-hidden":"true"},"#",-1),ka={href:"http://drf.jiuyou.info/#/drf/serializers?id=read-write-baseserializer-%E7%B1%BB",title:"Read-write BaseSerializer 类",target:"_blank",rel:"noopener noreferrer"},va=t(`<p>要创建一个可读写的序列化类，我们首先需要实现一个 <code>.to_internal_value()</code> 方法。此方法返回将用于构造对象实例的验证值，并且如果提供的数据格式不正确，则可能引发 <code>ValidationError</code> 。</p><p>一旦实现 <code>.to_internal_value()</code>，基本验证 API 将在序列化器中可用，并且你将能够使用 <code>.is_valid()</code>，<code>.validated_data</code> 和 <code>.errors</code>。</p><p>如果你还想支持 <code>.save()</code>，则还需要实现 <code>.create()</code> 和 <code>.update()</code>方法中的一个或两个。</p><p>以下是我们之前的 <code>HighScoreSerializer</code> 的一个完整示例，该示例已更新为支持读取和写入操作。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">HighScoreSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>BaseSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">to_internal_value</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        score <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">)</span>
        player_name <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;player_name&#39;</span><span class="token punctuation">)</span>

        <span class="token comment"># Perform the data validation.</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> score<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">&#39;score&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;This field is required.&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> player_name<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">&#39;player_name&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;This field is required.&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>player_name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">&#39;player_name&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;May not be more than 10 characters.&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment"># Return the validated values. This will be available as</span>
        <span class="token comment"># the \`.validated_data\` property.</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;score&#39;</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&#39;player_name&#39;</span><span class="token punctuation">:</span> player_name
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;score&#39;</span><span class="token punctuation">:</span> obj<span class="token punctuation">.</span>score<span class="token punctuation">,</span>
            <span class="token string">&#39;player_name&#39;</span><span class="token punctuation">:</span> obj<span class="token punctuation">.</span>player_name
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> HighScore<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),ma={id:"创建新的基类",tabindex:"-1"},ba=n("a",{class:"header-anchor",href:"#创建新的基类","aria-hidden":"true"},"#",-1),ha={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E5%9F%BA%E7%B1%BB",title:"创建新的基类",target:"_blank",rel:"noopener noreferrer"},_a=t(`<p>如果你希望实现新的泛型序列化类来处理特定的序列化风格，或者与可选的存储后端进行集成，那么 <code>BaseSerializer</code> 类也很有用。</p><p>以下类是可以处理将任意对象强制转换为基本表示形式的泛型序列化类的示例。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ObjectSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>BaseSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    A read-only serializer that coerces arbitrary complex objects
    into primitive representations.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> attribute_name <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
            attribute <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> attribute_name<span class="token punctuation">)</span>
            <span class="token keyword">if</span> attribute_name<span class="token punctuation">(</span><span class="token string">&#39;_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Ignore private attributes.</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>attribute<span class="token punctuation">,</span> <span class="token string">&#39;__call__&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Ignore methods and other callables.</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>attribute<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Primitive types can be passed through unmodified.</span>
                output<span class="token punctuation">[</span>attribute_name<span class="token punctuation">]</span> <span class="token operator">=</span> attribute
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>attribute<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Recursively deal with items in lists.</span>
                output<span class="token punctuation">[</span>attribute_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
                    self<span class="token punctuation">.</span>to_representation<span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> attribute
                <span class="token punctuation">]</span>
            <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>attribute<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Recursively deal with items in dictionaries.</span>
                output<span class="token punctuation">[</span>attribute_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token builtin">str</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>to_representation<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> attribute<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Force anything else to its string representation.</span>
                output<span class="token punctuation">[</span>attribute_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),ga={id:"serializer-使用进阶",tabindex:"-1"},fa=n("a",{class:"header-anchor",href:"#serializer-使用进阶","aria-hidden":"true"},"#",-1),Ea={href:"http://drf.jiuyou.info/#/drf/serializers?id=serializer-%E4%BD%BF%E7%94%A8%E8%BF%9B%E9%98%B6",title:"Serializer 使用进阶",target:"_blank",rel:"noopener noreferrer"},ya={id:"重写序列化和反序列化行为",tabindex:"-1"},za=n("a",{class:"header-anchor",href:"#重写序列化和反序列化行为","aria-hidden":"true"},"#",-1),Aa={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E9%87%8D%E5%86%99%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%A1%8C%E4%B8%BA",title:"重写序列化和反序列化行为",target:"_blank",rel:"noopener noreferrer"},Ba=t(`<p>如果你需要更改序列化类的序列化或反序列化行为，可以通过覆盖 <code>.to_representation()</code> 或 <code>.to_internal_value()</code> 方法来实现。</p><p>以下原因可能需要重写这两个方法...</p><ul><li>为新的序列化基类添加新行为。</li><li>稍微修改现有类的行为。</li><li>提高经常访问的 API 端点的序列化性能，以便返回大量数据。</li></ul><p>这些方法的签名如下：</p><p><strong><code>.to_representation(self, obj)</code></strong></p><p>接受需要序列化的对象实例，并返回一个原始表示。通常这意味着返回一个内置 Python 数据类型的结构。可以处理的确切类型取决于您为 API 配置的渲染类。</p><p>可能会被重写以便修改表示风格。例如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Convert \`username\` to lowercase.&quot;&quot;&quot;</span>
    ret <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_representation<span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
    ret<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ret<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>.to_internal_value(self, data)</code></strong></p><p>将未验证的传入数据作为输入，并应返回将作为 <code>serializer.validated_data</code> 提供的验证数据。如果在序列化类上调用了 <code>.save()</code> ，则返回值也将传递给 <code>.create()</code> 或 <code>.update()</code> 方法。</p><p>如果验证失败，则该方法会引发 <code>serializers.ValidationError(errors)</code>。<code>errors</code> 参数应该是一个由字段名称（或 <code>settings.NON_FIELD_ERRORS_KEY</code>）映射到错误消息列表的字典。如果不需要改变反序列化行为，而是想提供对象级验证，则建议改为覆盖 <code>.validate()</code>方法。</p><p>传递给此方法的 <code>data</code> 参数通常是 <code>request.data</code> 的值，因此它提供的数据类型将取决于你为 API 配置的解析器类。</p>`,12),wa={id:"继承序列化类",tabindex:"-1"},Sa=n("a",{class:"header-anchor",href:"#继承序列化类","aria-hidden":"true"},"#",-1),Fa={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E7%BB%A7%E6%89%BF%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB",title:"继承序列化类",target:"_blank",rel:"noopener noreferrer"},xa=t(`<p>与 Django 表单类似，你可以通过继承来扩展和重用序列化类。这使你可以在父类上声明一组通用的字段或方法，然后可以在多个序列化类中使用它们。例如，</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyBaseSerializer</span><span class="token punctuation">(</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    my_field <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">validate_my_field</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">MySerializer</span><span class="token punctuation">(</span>MyBaseSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与 Django 的 <code>Model</code> 和 <code>ModelForm</code> 类一样，序列化类中的内部 <code>Meta</code> 类不会从其父类的内部 <code>Meta</code> 类中隐式继承。如果你想让 <code>Meta</code> 类继承父类，必须<code>明确的指出</code>。例如</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AccountSerializer</span><span class="token punctuation">(</span>MyBaseSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span>MyBaseSerializer<span class="token punctuation">.</span>Meta<span class="token punctuation">)</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Account
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>通常我们建议不要在内部的 Meta 类中使用继承，而是显式声明所有选项。</p></blockquote>`,5),Ca={id:"动态修改字段",tabindex:"-1"},qa=n("a",{class:"header-anchor",href:"#动态修改字段","aria-hidden":"true"},"#",-1),ja={href:"http://drf.jiuyou.info/#/drf/serializers?id=%E5%8A%A8%E6%80%81%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5",title:"动态修改字段",target:"_blank",rel:"noopener noreferrer"},Ma=t(`<p>一旦序列化类初始化完毕，就可以使用 <code>.fields</code> 属性访问在序列化类中设置的字段字典。通过访问和修改这个属性可以达到动态地修改序列化类的目的。</p><p>直接修改 <code>fields</code> 参数允许你做一些有趣的事情，比如在运行时改变序列化字段的参数，而不是在声明序列化类的时候。</p><p>举个栗子：</p><p>例如，如果你希望能够设置序列化类在初始化时应使用哪些字段，你可以创建这样一个序列化类，如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DynamicFieldsModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    A ModelSerializer that takes an additional \`fields\` argument that
    controls which fields should be displayed.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Don&#39;t pass the &#39;fields&#39; arg up to the superclass</span>
        fields <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;fields&#39;</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

        <span class="token comment"># Instantiate the superclass normally</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>DynamicFieldsModelSerializer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

        <span class="token keyword">if</span> fields <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># Drop any fields that are not specified in the \`fields\` argument.</span>
            allowed <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span>
            existing <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>fields<span class="token punctuation">)</span>
            <span class="token keyword">for</span> field_name <span class="token keyword">in</span> existing <span class="token operator">-</span> allowed<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>field_name<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这将允许你执行以下操作：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>DynamicFieldsModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>     <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>         model <span class="token operator">=</span> User
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>         fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> UserSerializer<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;jonwatts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;jon@example.com&#39;</span><span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span> UserSerializer<span class="token punctuation">(</span>user<span class="token punctuation">,</span> fields<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;jon@example.com&#39;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7);function Da(Ua,Ta){const e=p("ExternalLinkIcon"),o=p("RouterLink");return c(),l("div",null,[d,n("blockquote",null,[n("p",null,[n("a",k,[s("官方原文链接"),a(e)])])]),n("h2",v,[m,s(),n("a",b,[s("Serializers"),a(e)])]),h,n("h3",_,[g,s(),n("a",f,[s("申明序列化类"),a(e)])]),E,n("h4",y,[z,s(),n("a",A,[s("将附加属性传递给 "),a(e)]),n("a",B,[s(".save()"),a(e)])]),w,n("h4",S,[F,s(),n("a",x,[s("直接覆盖 "),a(e)]),n("a",C,[s(".save()"),a(e)]),n("a",q,[s("。"),a(e)])]),j,n("h4",M,[D,s(),n("a",U,[s("数据验证时抛出异常"),a(e)])]),T,n("h4",R,[L,s(),n("a",I,[s("字段级验证"),a(e)])]),N,n("h3",P,[H,s(),n("a",O,[s("处理嵌套对象"),a(e)])]),V,n("h3",J,[K,s(),n("a",W,[s("可写嵌套表示"),a(e)])]),G,n("h4",Y,[X,s(),n("a",Q,[s("为嵌套表示书写 "),a(e)]),n("a",Z,[s(".create()"),a(e)]),n("a",$,[s(" 方法"),a(e)])]),nn,n("h4",sn,[an,s(),n("a",en,[s("为嵌套表示书写 "),a(e)]),n("a",tn,[s(".update()"),a(e)]),n("a",pn,[s(" 方法"),a(e)])]),on,n("p",null,[s("不过，有第三方软件包可用，如支持自动可写嵌套表示的"),n("a",cn,[s("DRF Writable Nested"),a(e)]),s("。")]),n("h4",ln,[rn,s(),n("a",un,[s("在模型管理器类中保存相关的实例"),a(e)])]),dn,n("h3",kn,[vn,s(),n("a",mn,[s("处理多个对象"),a(e)])]),bn,n("h4",hn,[_n,s(),n("a",gn,[s("反序列化多个对象"),a(e)])]),fn,n("h3",En,[yn,s(),n("a",zn,[s("包含额外的上下文"),a(e)])]),An,n("p",null,[a(o,{to:"/docs/python/%E9%87%8D%E5%86%99DRF%E7%9A%84to_representation%E5%92%8Cto_int/%E9%87%8D%E5%86%99DRF%E7%9A%84to_representation%E5%92%8Cto_internal_value%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8%E9%80%94-.html",title:"重写DRF的to_representation和to_internal_value方法有什么用途?"},{default:r(()=>[s("重写DRF的to_representation和to_internal_value方法有什么用途?")]),_:1})]),n("h2",Bn,[wn,s(),n("a",Sn,[s("ModelSerializer"),a(e)])]),Fn,n("h3",xn,[Cn,s(),n("a",qn,[s("检查 "),a(e)]),n("a",jn,[s("ModelSerializer"),a(e)])]),Mn,n("h3",Dn,[Un,s(),n("a",Tn,[s("指定要包含的字段"),a(e)])]),Rn,n("h3",Ln,[In,s(),n("a",Nn,[s("指定嵌套序列化"),a(e)])]),Pn,n("h3",Hn,[On,s(),n("a",Vn,[s("显式指定字段"),a(e)])]),Jn,n("h3",Kn,[Wn,s(),n("a",Gn,[s("指定只读字段"),a(e)])]),Yn,n("h3",Xn,[Qn,s(),n("a",Zn,[s("其他关键字参数"),a(e)])]),$n,n("h3",ns,[ss,s(),n("a",as,[s("关系字段"),a(e)])]),es,ts,n("h3",ps,[os,s(),n("a",is,[s("自定义字段映射"),a(e)])]),cs,n("h4",ls,[rs,s(),n("a",us,[s("field_class 和 field_kwargs API"),a(e)])]),ds,n("h2",ks,[vs,s(),n("a",ms,[s("HyperlinkedModelSerializer"),a(e)])]),bs,n("h3",hs,[_s,s(),n("a",gs,[s("绝对和相对 URL"),a(e)])]),fs,n("h3",Es,[ys,s(),n("a",zs,[s("如何确定超链接视图"),a(e)])]),As,n("h3",Bs,[ws,s(),n("a",Ss,[s("更改 URL 字段名称"),a(e)])]),Fs,n("h2",xs,[Cs,s(),n("a",qs,[s("ListSerializer"),a(e)])]),js,n("h3",Ms,[Ds,s(),n("a",Us,[s("allow_empty"),a(e)])]),Ts,n("h3",Rs,[Ls,s(),n("a",Is,[s("自定义 "),a(e)]),n("a",Ns,[s("ListSerializer"),a(e)]),n("a",Ps,[s(" 行为"),a(e)])]),Hs,n("h4",Os,[Vs,s(),n("a",Js,[s("自定义多个对象的创建"),a(e)])]),Ks,n("h4",Ws,[Gs,s(),n("a",Ys,[s("自定义多个对象的更新"),a(e)])]),Xs,n("h4",Qs,[Zs,s(),n("a",$s,[s("自定义 ListSerializer 初始化"),a(e)])]),na,n("h2",sa,[aa,s(),n("a",ea,[s("BaseSerializer"),a(e)])]),ta,n("h3",pa,[oa,s(),n("a",ia,[s("Read-only "),a(e)]),n("a",ca,[s("BaseSerializer"),a(e)]),n("a",la,[s(" 类"),a(e)])]),ra,n("h3",ua,[da,s(),n("a",ka,[s("Read-write BaseSerializer 类"),a(e)])]),va,n("h3",ma,[ba,s(),n("a",ha,[s("创建新的基类"),a(e)])]),_a,n("h2",ga,[fa,s(),n("a",Ea,[s("Serializer 使用进阶"),a(e)])]),n("h3",ya,[za,s(),n("a",Aa,[s("重写序列化和反序列化行为"),a(e)])]),Ba,n("h3",wa,[Sa,s(),n("a",Fa,[s("继承序列化类"),a(e)])]),xa,n("h3",Ca,[qa,s(),n("a",ja,[s("动态修改字段"),a(e)])]),Ma])}const Ia=i(u,[["render",Da],["__file","Rest-framework专栏讲解(十一)：Serializers (1).html.vue"]]);export{Ia as default};
