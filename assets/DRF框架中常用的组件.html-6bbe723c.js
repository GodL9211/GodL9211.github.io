import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o,c as l,a as n,b as s,e as t,f as a}from"./app-967d79b2.js";const c="/assets/image_ihCCP-rt0p-d2d07dce.png",r="/assets/image_lYhp_q6yQN-7d6337f0.png",d="/assets/image_aqXDhrhdNG-35200500.png",u="/assets/image_Bd8bomFNdq-1ecb4150.png",k={},v=a('<h1 id="drf框架中常用的组件" tabindex="-1"><a class="header-anchor" href="#drf框架中常用的组件" aria-hidden="true">#</a> DRF框架中常用的组件</h1><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录" aria-hidden="true">#</a> 目录</h2><ul><li><a href="#1-%E8%AE%A4%E8%AF%81">1. 认证</a><ul><li><a href="#11%E5%85%A8%E5%B1%80%E8%AE%A4%E8%AF%81">1.1全局认证</a></li><li><a href="#12%E9%83%A8%E5%88%86%E8%AE%A4%E8%AF%81">1.2部分认证</a></li></ul></li><li><a href="#2%E6%9D%83%E9%99%90">2.权限</a><ul><li><a href="#21%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9D%83%E9%99%90">2.1提供的权限</a></li><li><a href="#22%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE">2.2全局配置</a></li><li><a href="#23%E5%B1%80%E9%83%A8%E6%9D%83%E9%99%90">2.3局部权限</a></li><li><a href="#24%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90">2.4自定义权限</a></li></ul></li><li><a href="#3-%E9%99%90%E6%B5%81">3. 限流</a><ul><li><a href="#31%E5%AE%9A%E4%B9%89">3.1定义</a></li><li><a href="#32%E5%85%A8%E5%B1%80%E9%99%90%E6%B5%81">3.2全局限流</a></li><li><a href="#33%E5%B1%80%E9%83%A8%E9%99%90%E6%B5%81">3.3局部限流</a></li></ul></li><li><a href="#4-%E8%BF%87%E6%BB%A4">4. 过滤</a><ul><li><a href="#41%E5%AE%9A%E4%B9%89">4.1定义</a></li><li><a href="#42%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE">4.2全局配置</a></li><li><a href="#43%E5%B1%80%E9%83%A8%E9%85%8D%E7%BD%AE">4.3局部配置</a></li></ul></li><li><a href="#5-%E6%8E%92%E5%BA%8F">5. 排序</a><ul><li><a href="#51%E5%9F%BA%E6%9C%AC%E6%8E%92%E5%BA%8F">5.1基本排序</a></li><li><a href="#2%E8%BF%87%E6%BB%A4%E6%8E%92%E5%BA%8F">2.过滤排序</a></li></ul></li><li><a href="#6-%E5%88%86%E9%A1%B5">6. 分页</a><ul><li><a href="#61%E5%85%A8%E5%B1%80%E5%88%86%E9%A1%B5">6.1.全局分页</a></li><li><a href="#2%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5">2.自定义分页</a><ul><li><a href="#1%E9%A1%B5%E7%A0%81%E5%88%86%E9%A1%B5%E7%B1%BB">1.页码分页类</a></li><li><a href="#2%E5%81%8F%E7%A7%BB%E5%88%86%E9%A1%B5%E7%B1%BB">2.偏移分页类</a></li></ul></li></ul></li><li><a href="#7-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-Exceptions">7. 异常处理 Exceptions</a><ul><li><a href="#1DRF%E7%9A%84%E5%BC%82%E5%B8%B8">1.DRF的异常</a></li><li><a href="#2%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8">2.自定义异常</a></li></ul></li><li><a href="#8-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3">8. 自动生成接口文档</a><ul><li><a href="#81-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">8.1. 安装依赖</a></li><li><a href="#82-%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84">8.2. 设置接口文档访问路径</a><ul><li><a href="#83-%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E8%AF%B4%E6%98%8E%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE">8.3. 文档描述说明的定义位置</a></li></ul></li><li><a href="#84-%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%BD%91%E9%A1%B5">8.4. 访问接口文档网页</a><ul><li><a href="#%E4%B8%A4%E7%82%B9%E8%AF%B4%E6%98%8E">两点说明：</a></li></ul></li></ul></li></ul>',3),m={href:"https://blog.csdn.net/weixin_44689630/article/details/118079118",target:"_blank",rel:"noopener noreferrer"},h=a(`<p>为了方便接下来的学习，我们创建一个新的子应用 opt</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py startapp opt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>提前在总路由和配置文件中注册子应用和配置总路由。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># settings.py中注册子应用：</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment"># ....</span>
  <span class="token string">&#39;opt&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token comment"># 总路由中加上：</span>
path<span class="token punctuation">(</span><span class="token string">&quot;opt/&quot;</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span><span class="token string">&quot;opt.urls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为接下来的功能中需要使用到登陆功能，所以我们使用django内置admin站点并创建一个管理员.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py createsuperuser
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+c+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>创建管理员以后，访问admin站点，先修改站点的语言配置:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># settings.py</span>
LANGUAGE_CODE <span class="token operator">=</span> <span class="token string">&#39;zh-hans&#39;</span>
TIME_ZONE <span class="token operator">=</span> <span class="token string">&#39;Asia/Shanghai&#39;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>访问admin 站点效果：</p><figure><img src="'+d+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_1-认证" tabindex="-1"><a class="header-anchor" href="#_1-认证" aria-hidden="true">#</a> 1. 认证</h2><h3 id="_1-1全局认证" tabindex="-1"><a class="header-anchor" href="#_1-1全局认证" aria-hidden="true">#</a> 1.1全局认证</h3><p>可以在/rest_framework/settings.py配置文件中查询全局默认的认证方案</p><p>可以在项目的主应用的settings.py配置文件中加入以下配置覆盖全局默认的配置方案</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="token punctuation">,</span>  <span class="token comment"># session认证</span>
        <span class="token string">&#39;rest_framework.authentication.BasicAuthentication&#39;</span><span class="token punctuation">,</span>    <span class="token comment"># 基本认证</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2部分认证" tabindex="-1"><a class="header-anchor" href="#_1-2部分认证" aria-hidden="true">#</a> 1.2部分认证</h3><p>可以在每个视图中通过设置authentication_classess类属性来设置</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication<span class="token punctuation">,</span> BasicAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView

<span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 类属性</span>
    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">,</span> BasicAuthentication<span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>认证失败</strong>会有两种可能的返回值,这个需要我们配合<strong>权限组件</strong>来使用：</p><table><thead><tr><th>编码</th><th>含义</th></tr></thead><tbody><tr><td>401</td><td>Unauthorized 未认证</td></tr><tr><td>403</td><td>Permission Denied 权限被禁止</td></tr></tbody></table><h2 id="_2-权限" tabindex="-1"><a class="header-anchor" href="#_2-权限" aria-hidden="true">#</a> 2.权限</h2><p>权限控制可以限制用户对于视图的访问和对于具体数据模型对象的访问。</p><ul><li>在执行视图的as_view()方法的dispatch()方法前,会先进行视图访问权限的判断</li><li>在通过get_object()获取具体模型对象时,会进行模型对象访问权限的判断</li></ul><h3 id="_2-1提供的权限" tabindex="-1"><a class="header-anchor" href="#_2-1提供的权限" aria-hidden="true">#</a> 2.1提供的权限</h3><table><thead><tr><th>权限</th><th></th></tr></thead><tbody><tr><td>AllowAny</td><td>允许所有用户</td></tr><tr><td>IsAuthenticated</td><td>仅通过登录认证的用户</td></tr><tr><td>IsAdminUser</td><td>仅管理员用户</td></tr><tr><td>IsAuthenticatedOrReadOnly</td><td>已经登陆认证的用户可以对数据进行增删改操作，没有登陆认证的只能查看数据。</td></tr></tbody></table><h3 id="_2-2全局配置" tabindex="-1"><a class="header-anchor" href="#_2-2全局配置" aria-hidden="true">#</a> 2.2全局配置</h3><p>在配置文件settings.py中全局设置默认的权限管理类，如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">#  权限[全局配置，所有的视图都会被影响到]</span>
    <span class="token string">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 已经登录认证的用户才能访问</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果未指明，则采用如下默认配置</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token string">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
   <span class="token string">&#39;rest_framework.permissions.AllowAny&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong></p><blockquote><p>drf的配置信息,需要卸载django的配置文件,而且必须写在REST_FRAMEWORK的字典中,才能被drf识别</p><p>chorme浏览器进入无痕模式的快捷键，Ctrl+Shift+N</p></blockquote><h3 id="_2-3局部权限" tabindex="-1"><a class="header-anchor" href="#_2-3局部权限" aria-hidden="true">#</a> 2.3局部权限</h3><p>可以在具体的视图中通过permission_classes属性来设置，如:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> RetrieveAPIView

<span class="token keyword">class</span> <span class="token class-name">StudentAPIView</span><span class="token punctuation">(</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentSerializer
    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">]</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4自定义权限" tabindex="-1"><a class="header-anchor" href="#_2-4自定义权限" aria-hidden="true">#</a> 2.4自定义权限</h3><p>自定义权限,需继承rest_framework.permissions.BasePermission父类,并实现以下两个任何一个方法或全部</p><table><thead><tr><th>方法</th><th>含义</th></tr></thead><tbody><tr><td><code>.has_permission(self, request, view)</code></td><td>是否可以访问视图,view表示当前<strong>视图对象</strong></td></tr><tr><td><code>.has_object_permission(self, request, view, obj)</code></td><td>是否可以访问数据模型对象, view表示当前<strong>视图</strong>, <strong>obj为模型数据对象</strong></td></tr></tbody></table><p>在当前子应用下,创建一个权限文件permissions.py中声明自定义权限类:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> BasePermission

<span class="token keyword">class</span> <span class="token class-name">IsXiaoMingPermission</span><span class="token punctuation">(</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>user <span class="token keyword">and</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username <span class="token operator">==</span> <span class="token string">&quot;xiaoming&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> <span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsXiaoMingPermission
<span class="token keyword">class</span> <span class="token class-name">StudentViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsXiaoMingPermission<span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_3-限流" tabindex="-1"><a class="header-anchor" href="#_3-限流" aria-hidden="true">#</a> 3. 限流</h1><h3 id="_3-1定义" tabindex="-1"><a class="header-anchor" href="#_3-1定义" aria-hidden="true">#</a> 3.1定义</h3><p>目地:</p><blockquote><p>可以对接口访问的频次进行限制,以减轻服务器压力,或者实现特定的业务</p></blockquote><p>场景:</p><blockquote><p>一般用于付费购买次数,投票等场景使用.</p></blockquote><p><strong>Throttling限流类</strong></p><table><thead><tr><th>可选类</th><th></th></tr></thead><tbody><tr><td>AnonRateThrottle</td><td>限制所有匿名未认证用户,使用IP区分用户,使用<code>DEFAULT_THROTTLE_RATES[&#39;anon&#39;]</code> 来设置频次</td></tr><tr><td>UserRateThrottle</td><td>限制认证用户,使用User id 来区分,使用<code>DEFAULT_THROTTLE_RATES[&#39;user&#39;]</code> 来设置频次</td></tr><tr><td>ScopedRateThrottle</td><td>限制用户对于每个视图的访问频次,使用ip或user id</td></tr></tbody></table><p><strong>APIView的流量控制属性</strong></p><table><thead><tr><th>属性名</th><th></th></tr></thead><tbody><tr><td>throttle_scope</td><td>节流范围</td></tr><tr><td>throttle_classes</td><td>节流类</td></tr></tbody></table><h3 id="_3-2全局限流" tabindex="-1"><a class="header-anchor" href="#_3-2全局限流" aria-hidden="true">#</a> 3.2全局限流</h3><p>可以在配置文件中</p><p>使用<code>DEFAULT_THROTTLE_CLASSES</code>(启用的限制类)</p><p><code>DEFAULT_THROTTLE_RATES</code>(限制频率)进行全局配置</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;DEFAULT_THROTTLE_CLASSES&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span> <span class="token comment"># 全局启用的限制类</span>
        <span class="token string">&#39;rest_framework.throttling.AnonRateThrottle&#39;</span><span class="token punctuation">,</span><span class="token comment"># 匿名用户</span>
        <span class="token string">&#39;rest_framework.throttling.UserRateThrottle&#39;</span><span class="token comment"># 登录用户</span>
        <span class="token string">&#39;rest_framework.throttling.ScopedRateThrottle&#39;</span><span class="token punctuation">,</span><span class="token comment">#指定用户</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>   <span class="token comment"># 限制频率</span>
        <span class="token string">&#39;anon&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;3/minute&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;10/minute&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;access&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;5/minute&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 这个是自定义限流的频率配置</span>
        <span class="token string">&#39;contacts&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;1000/day&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;uploads&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;20/day&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3局部限流" tabindex="-1"><a class="header-anchor" href="#_3-3局部限流" aria-hidden="true">#</a> 3.3局部限流</h3><p><code>DEFAULT_THROTTLE_RATES</code> 可以使用 <code>second</code>, <code>minute</code>, <code>hour</code> 或<code>day</code>来指明周期.也可以在具体视图中通过throttle_classess属性来配置</p>`,60),b={href:"http://xn--setting-i22m.py",title:"如setting.py",target:"_blank",rel:"noopener noreferrer"},g=a(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;DEFAULT_THROTTLE_RATES&#39;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token string">&#39;anon&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;2/minute&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;4/minute&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;jason&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;3/minute&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),_={href:"http://views.py",title:"views.py",target:"_blank",rel:"noopener noreferrer"},E=a(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle<span class="token punctuation">,</span>AnonRateThrottle<span class="token punctuation">,</span>ScopedRateThrottle
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Student

<span class="token keyword">class</span> <span class="token class-name">Student13APIViewSet</span><span class="token punctuation">(</span>ReadOnlyModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#匿名用户</span>
    throttle_classes <span class="token operator">=</span> <span class="token punctuation">(</span>AnonRateThrottle<span class="token punctuation">,</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentModelSerializer
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Student14APIViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#认证用户</span>
    throttle_classes <span class="token operator">=</span> <span class="token punctuation">(</span>UserRateThrottle<span class="token punctuation">,</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentModelSerializer
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token keyword">class</span> <span class="token class-name">Student15APIViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#自定义用户</span>
    throttle_classes <span class="token operator">=</span> <span class="token punctuation">[</span>ScopedRateThrottle<span class="token punctuation">]</span>
    throttle_scope<span class="token operator">=</span><span class="token string">&quot;jason&quot;</span>
    serializer_class <span class="token operator">=</span> StudentModelSerializer
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-过滤" tabindex="-1"><a class="header-anchor" href="#_4-过滤" aria-hidden="true">#</a> 4. 过滤</h1><h3 id="_4-1定义" tabindex="-1"><a class="header-anchor" href="#_4-1定义" aria-hidden="true">#</a> 4.1定义</h3><p>对于列表数据可能需要根据字段进行过滤，我们可以通过添加django-fitlter扩展来增强支持。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pip install django<span class="token operator">-</span><span class="token builtin">filter</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在配置文件settings.py中增加过滤组件的设置：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">&#39;django_filters&#39;</span><span class="token punctuation">,</span>  <span class="token comment"># 需要注册应用，</span>
<span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2全局配置" tabindex="-1"><a class="header-anchor" href="#_4-2全局配置" aria-hidden="true">#</a> 4.2全局配置</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment"># 全局配置，也可以使用局部配置</span>
    <span class="token string">&#39;DEFAULT_FILTER_BACKENDS&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">&#39;django_filters.rest_framework.DjangoFilterBackend&#39;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3局部配置" tabindex="-1"><a class="header-anchor" href="#_4-3局部配置" aria-hidden="true">#</a> 4.3局部配置</h3><p>注意:</p><blockquote><p>局部配置的前提是进行全局配置,然后再在视图类中添加类属性filter_fields,指定可以过滤的字段</p></blockquote><h1 id="_5-排序" tabindex="-1"><a class="header-anchor" href="#_5-排序" aria-hidden="true">#</a> 5. 排序</h1><p>对于列表数据,按照指定字段进行排序,REST framework会在请求的查询字符串参数中检查是否包含了ordering参数，如果包含了ordering参数，则按照ordering参数指明的排序字段对数据集进行排序,ordering参数的可选字段值需要在ordering_fields中指明。</p><p>from rest_framework.filters import OrderingFilter</p><h3 id="_5-1基本排序" tabindex="-1"><a class="header-anchor" href="#_5-1基本排序" aria-hidden="true">#</a> 5.1基本排序</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>filters <span class="token keyword">import</span> OrderingFilter
<span class="token keyword">class</span> <span class="token class-name">StudentListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentModelSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>OrderingFilter<span class="token punctuation">]</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>books<span class="token operator">/</span>?ordering<span class="token operator">=</span><span class="token operator">-</span>age
<span class="token operator">-</span><span class="token builtin">id</span> 表示针对<span class="token builtin">id</span>字段进行倒序排序
<span class="token builtin">id</span>  表示针对<span class="token builtin">id</span>字段进行升序排序

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-过滤排序" tabindex="-1"><a class="header-anchor" href="#_2-过滤排序" aria-hidden="true">#</a> 2.过滤排序</h3><p>注意</p><blockquote><p>因为排序配置和过滤配置使用同一个类属性,如果需要在过滤以后再次进行排序,则需要两者同步,要么一起写在全局配置中,要么一起写在视图类中,否则会出现过滤组件使用无效的情况</p></blockquote><p>配置文件：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">#过滤组件[全局引入]</span>
  <span class="token string">&#39;DEFAULT_FILTER_BACKENDS&#39;</span><span class="token punctuation">(</span><span class="token string">&#39;django_filters.rest_framework.DjangoFilterBackend&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;rest_framework.filters.OrderingFilter&#39;</span><span class="token punctuation">)</span>
    
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> ListAPIView
<span class="token keyword">from</span> students<span class="token punctuation">.</span>models <span class="token keyword">import</span> Student
<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> StudentModelSerializer
<span class="token keyword">from</span> django_filters<span class="token punctuation">.</span>rest_framework <span class="token keyword">import</span> DjangoFilterBackend
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>filters <span class="token keyword">import</span> OrderingFilter

<span class="token keyword">class</span> <span class="token class-name">Student3ListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentModelSerializer
    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>DjangoFilterBackend<span class="token punctuation">,</span>OrderingFilter<span class="token punctuation">]</span>
    filter_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sex&#39;</span><span class="token punctuation">)</span>
    ordering_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">)</span>
   

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_6-分页" tabindex="-1"><a class="header-anchor" href="#_6-分页" aria-hidden="true">#</a> 6. 分页</h1><h3 id="_6-1-全局分页" tabindex="-1"><a class="header-anchor" href="#_6-1-全局分页" aria-hidden="true">#</a> 6.1.全局分页</h3><p>REST framework提供了分页的支持,我们可以在配置文件中设置全局的分页方式,如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">#设置了全局分页,那么在drf中凡是调用了ListModelMixin的list(),都会自动分页</span>
    <span class="token string">&#39;DEFAULT_PAGINATION_CLASS&#39;</span><span class="token punctuation">:</span>  <span class="token string">&#39;rest_framework.pagination.PageNumberPagination&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;PAGE_SIZE&#39;</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token comment"># 每页数目</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> 视图类<span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 只存在少部分数据,关闭分页功能</span>
  pagination_class <span class="token operator">=</span> <span class="token boolean">None</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-自定义分页" tabindex="-1"><a class="header-anchor" href="#_2-自定义分页" aria-hidden="true">#</a> 2.自定义分页</h3><p>也可通过自定义Pagination类,来为视图添加不同分页行为。在视图中通过<code>pagination_clas</code>属性来指明</p><h4 id="_1-页码分页类" tabindex="-1"><a class="header-anchor" href="#_1-页码分页类" aria-hidden="true">#</a> 1.页码分页类</h4><p>前端访问网址形式：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>GET  http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>students<span class="token operator">/</span>?page<span class="token operator">=</span><span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>PageNumberPagination</strong></p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>page_size</td><td>每页数目</td></tr><tr><td>page_query_param</td><td>前端发送的<strong>页数</strong>关键字名，默认为&quot;page&quot;</td></tr><tr><td>page_size_query_param</td><td>前端发送的<strong>每页数目</strong>关键字名，默认为None</td></tr><tr><td>max_page_size</td><td>前端最多能设置的每页数量</td></tr></tbody></table><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># 声明分页的配置类</span>
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>pagination <span class="token keyword">import</span> PageNumberPagination
<span class="token keyword">class</span> <span class="token class-name">StandardPageNumberPagination</span><span class="token punctuation">(</span>PageNumberPagination<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 默认每一页显示的数据量</span>
    page_size <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token comment"># 允许客户端通过get参数来控制每一页的数据量</span>
    page_size_query_param <span class="token operator">=</span> <span class="token string">&quot;size&quot;</span>
    max_page_size <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token comment"># 自定义页码的参数名</span>
    page_query_param <span class="token operator">=</span> <span class="token string">&quot;p&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">StudentAPIView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> StudentModelSerializer
    pagination_class <span class="token operator">=</span> StandardPageNumberPagination

<span class="token comment"># 127.0.0.1/four/students/?p=1&amp;size=5</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-偏移分页类" tabindex="-1"><a class="header-anchor" href="#_2-偏移分页类" aria-hidden="true">#</a> 2.偏移分页类</h4><p>前端访问网址形式：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>GET http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">/</span>four<span class="token operator">/</span>students<span class="token operator">/</span>?limit<span class="token operator">=</span><span class="token number">100</span><span class="token operator">&amp;</span>offset<span class="token operator">=</span><span class="token number">100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>LimitOffsetPagination</strong></p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>default_limit</td><td>默认限制,默认值与<code>PAGE_SIZE</code>设置一致</td></tr><tr><td>limit_query_param</td><td>limit参数名,默认’limit’</td></tr><tr><td>offset_query_param</td><td>offset参数名,默认’offset’</td></tr><tr><td>max_limit</td><td>最大limit限制,默认None</td></tr></tbody></table>`,42),y={id:"_7-异常处理-exceptions",tabindex:"-1"},f=n("a",{class:"header-anchor",href:"#_7-异常处理-exceptions","aria-hidden":"true"},"#",-1),A={href:"https://so.csdn.net/so/search?q=%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86&spm=1001.2101.3001.7020",title:"异常处理",target:"_blank",rel:"noopener noreferrer"},w=a(`<h3 id="_1-drf的异常" tabindex="-1"><a class="header-anchor" href="#_1-drf的异常" aria-hidden="true">#</a> 1.DRF的异常</h3><table><thead><tr><th>异常名</th><th>含义</th></tr></thead><tbody><tr><td>APIException</td><td>drf中所有异常的父类</td></tr><tr><td>ParseError</td><td>解析错误</td></tr><tr><td>AuthenticationFailed</td><td>认证失败</td></tr><tr><td>NotAuthenticated</td><td>尚未认证</td></tr><tr><td>PermissionDenied</td><td>权限受限</td></tr><tr><td>NotFound</td><td>未找到</td></tr><tr><td>MethodNotAllowed</td><td>请求方式不支持</td></tr><tr><td>NotAcceptable</td><td>要获取的数据格式不支持</td></tr><tr><td>Throttled</td><td>超过限流次数</td></tr><tr><td>ValidationError</td><td>校验失败</td></tr></tbody></table><h3 id="_2-自定义异常" tabindex="-1"><a class="header-anchor" href="#_2-自定义异常" aria-hidden="true">#</a> 2.自定义异常</h3><p>REST framework提供了自定义异常处理,我们可以自定义的方式来编写异常处理函数.例如我们想在要创建一个自定义异常函数,这个函数,我们保存到当前主应用中[注意在实际工作中,我们可以设置一个单独的独立的公共目录来保存这种公共的函数/工具/类库,也就是说,很多的没有在上面列出来的异常,就需要我们在自定义异常中自己处理了</p><p>在主应用的配置文件settings.py中声明自定义的异常处理</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 异常处理</span>
    <span class="token string">&#39;EXCEPTION_HANDLER&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;drfdemo.exceptions.custom_exception_handler&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果未声明,会采用默认的方式,如下rest_frame/settings.py</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;EXCEPTION_HANDLER&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;rest_framework.views.exception_handler&#39;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>drfdemo/exceptions.py</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler <span class="token keyword">as</span> drf_exception_handler
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> DatabaseError
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status
<span class="token keyword">def</span> <span class="token function">custom_exception_handler</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    自定义异常处理函数
    :param exc: 异常对象，本次发生的异常对象
    :param context: 字典，异常出现时的执行上下文环境
    :return:
    &quot;&quot;&quot;</span>
    <span class="token comment"># 先让drf进行异常判断</span>
    response <span class="token operator">=</span> drf_exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span>

    <span class="token comment"># 判断response对象是否为None</span>
    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;出现drf不能处理的异常&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> DatabaseError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            view <span class="token operator">=</span> context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;view&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;数据库报错,</span><span class="token interpolation"><span class="token punctuation">{</span>view<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>exc<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;服务器内部错误!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_507_INSUFFICIENT_STORAGE<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> ZeroDivisionError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            view <span class="token operator">=</span> context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;view&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;0不能做为除数!</span><span class="token interpolation"><span class="token punctuation">{</span>view<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>exc<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;服务器内部错误!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_500_INTERNAL_SERVER_ERROR<span class="token punctuation">)</span>

    <span class="token keyword">return</span> response

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_8-自动生成接口文档" tabindex="-1"><a class="header-anchor" href="#_8-自动生成接口文档" aria-hidden="true">#</a> 8. 自动生成接口文档</h1>`,11),S={href:"http://core-api.github.io/python-client/",title:"http://core-api.github.io/python-client/",target:"_blank",rel:"noopener noreferrer"},x=a(`<p>REST framework可以自动帮助我们生成接口文档。</p><p>接口文档以网页的方式呈现。</p><p>自动接口文档能生成的是继承自<code>APIView</code>及其子类的视图。</p><h2 id="_8-1-安装依赖" tabindex="-1"><a class="header-anchor" href="#_8-1-安装依赖" aria-hidden="true">#</a> 8.1. 安装依赖</h2><p>REST framewrok生成接口文档需要<code>coreapi</code>库的支持。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>pip install coreapi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-2-设置接口文档访问路径" tabindex="-1"><a class="header-anchor" href="#_8-2-设置接口文档访问路径" aria-hidden="true">#</a> 8.2. 设置接口文档访问路径</h2><p>在settings.py中配置接口文档。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 。。。 其他选项</span>
    <span class="token comment"># 接口文档</span>
    <span class="token string">&#39;DEFAULT_SCHEMA_CLASS&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;rest_framework.schemas.AutoSchema&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong>:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">#1.搜索self.request.method方法在文件中的使用</span>
<span class="token keyword">if</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> StudentModelSerializer
<span class="token comment">#2.将代码修改为以下    </span>
<span class="token keyword">if</span> self<span class="token punctuation">.</span>request <span class="token keyword">and</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>method<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> StudentModelSerializer   

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在总路由中添加接口文档路径。</p><p>文档路由对应的视图配置为<code>rest_framework.documentation.include_docs_urls</code>，</p><p>参数<code>title</code>为接口文档网站的标题。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>documentation <span class="token keyword">import</span> include_docs_urls

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    path<span class="token punctuation">(</span><span class="token string">&#39;docs/&#39;</span><span class="token punctuation">,</span> include_docs_urls<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&#39;站点页面标题&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-文档描述说明的定义位置" tabindex="-1"><a class="header-anchor" href="#_8-3-文档描述说明的定义位置" aria-hidden="true">#</a> 8.3. 文档描述说明的定义位置</h3><p>1） 单一方法的视图，可直接使用类视图的文档字符串，如:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    返回所有图书信息.
    &quot;&quot;&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）包含多个方法的视图，在类视图的文档字符串中，分开方法定义，如:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookListCreateView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    get:
    返回所有图书信息.

    post:
    新建图书.
    &quot;&quot;&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3）对于视图集ViewSet，仍在类视图的文档字符串中封开定义，但是应使用action名称区分，如:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    list:
    返回图书列表数据

    retrieve:
    返回图书详情数据

    latest:
    返回最新的图书数据

    read:
    修改图书的阅读量
    &quot;&quot;&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong> help_text</p><h2 id="_8-4-访问接口文档网页" tabindex="-1"><a class="header-anchor" href="#_8-4-访问接口文档网页" aria-hidden="true">#</a> 8.4. 访问接口文档网页</h2><p>浏览器访问 127.0.0.1:8000/docs/，即可看到自动生成的接口文档。</p><figure><img src="`+u+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="两点说明" tabindex="-1"><a class="header-anchor" href="#两点说明" aria-hidden="true">#</a> 两点说明：</h4><p>1） 视图集ViewSet中的retrieve名称,在接口文档网站中叫做read</p><p>2）参数的Description需要在模型类或序列化器类的字段中以help_text选项定义,如：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;年龄&#39;</span><span class="token punctuation">,</span> help_text<span class="token operator">=</span><span class="token string">&#39;年龄&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">StudentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Student
        fields <span class="token operator">=</span> <span class="token string">&quot;__all__&quot;</span>
        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&#39;age&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">&#39;help_text&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;年龄&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,32);function q(T,B){const e=p("ExternalLinkIcon");return o(),l("div",null,[v,n("p",null,[n("a",m,[s("https://blog.csdn.net/weixin_44689630/article/details/118079118"),t(e)])]),h,n("p",null,[n("a",b,[s("如setting.py"),t(e)])]),g,n("p",null,[n("a",_,[s("views.py"),t(e)])]),E,n("h1",y,[f,s(" 7. "),n("a",A,[s("异常处理"),t(e)]),s(" Exceptions")]),w,n("p",null,[s("官方文档："),n("a",S,[s("http://core-api.github.io/python-client/"),t(e)])]),x])}const P=i(k,[["render",q],["__file","DRF框架中常用的组件.html.vue"]]);export{P as default};
