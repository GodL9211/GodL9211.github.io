<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.63" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html"><meta property="og:site_name" content="暴走の海鸽"><meta property="og:title" content="上下文管理器和with语句"><meta property="og:description" content="嗨，大家好，我是暴走的海鸽。 今天，我将向大家介绍上下文管理器和with语句的使用方法。 以下上下文管理器、with未作特殊说明时均为同步原语。 什么是上下文管理器和with 有人认为Python中的with语句是一个晦涩难懂的特性，但是只要你了解了其背后的原理，就不会感觉到神秘了。with语句实际上是非常有用的特性，有助于编写清晰易读的Python..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-12-12T10:12:36.000Z"><meta property="article:author" content="Mr.暴走の海鸽"><meta property="article:modified_time" content="2023-12-12T10:12:36.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"上下文管理器和with语句","description":"嗨，大家好，我是暴走的海鸽。 今天，我将向大家介绍上下文管理器和with语句的使用方法。\r 以下上下文管理器、with未作特殊说明时均为同步原语。 什么是上下文管理器和with 有人认为Python中的with语句是一个晦涩难懂的特性，但是只要你了解了其背后的原理，就不会感觉到神秘了。with语句实际上是非常有用的特性，有助于编写清晰易读的Python..."}</script><link rel="alternate" type="application/atom+xml" href="https://vuepress-theme-hope-docs-demo.netlify.app/atom.xml" title="暴走の海鸽 Atom Feed"><link rel="alternate" type="application/json" href="https://vuepress-theme-hope-docs-demo.netlify.app/feed.json" title="暴走の海鸽 JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://vuepress-theme-hope-docs-demo.netlify.app/rss.xml" title="暴走の海鸽 RSS Feed"><link rel="icon" href="/logo.svg"><title>上下文管理器和with语句 | 暴走の海鸽</title><meta name="description" content="嗨，大家好，我是暴走的海鸽。 今天，我将向大家介绍上下文管理器和with语句的使用方法。 以下上下文管理器、with未作特殊说明时均为同步原语。 什么是上下文管理器和with 有人认为Python中的with语句是一个晦涩难懂的特性，但是只要你了解了其背后的原理，就不会感觉到神秘了。with语句实际上是非常有用的特性，有助于编写清晰易读的Python...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-039f801e.css" as="style"><link rel="stylesheet" href="/assets/style-039f801e.css">
    <link rel="modulepreload" href="/assets/app-967d79b2.js"><link rel="modulepreload" href="/assets/上下文管理器和with语句.html-a2fbfe29.js"><link rel="modulepreload" href="/assets/上下文管理器和with语句.html-ba4754a3.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt="暴走の海鸽"><!----><span class="vp-site-name hide-in-pad">暴走の海鸽</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/docs/quicknav/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>快速导航<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="面试指南"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>面试指南</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>django</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/django/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>django学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>flask</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/flask/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>flask学习笔记<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Python系列"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>Python系列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>django</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/django/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>django学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>flask</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/flask/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>flask学习笔记<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Golang系列"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>Golang系列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>gin</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/golang/gin/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>gin框架学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>kratos</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/golang/kratos/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>kratos学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>go设计模式</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/golang/go-design-pattern/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>golang设计模式<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="微服务系列"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>微服务系列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>django</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/django/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>django学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>flask</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/flask/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>flask学习笔记<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="云原生系列"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>云原生系列</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>django</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/django/%E5%AE%89%E8%A3%85django.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>安装django<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>flask</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/flask/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>flask学习笔记<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="投资理财"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>投资理财</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>django</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/django/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>django学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>flask</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/flask/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>flask学习笔记<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="诗歌"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>诗歌</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>django</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/django/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>django学习笔记<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>flask</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="vp-link nav-link" href="/docs/python/flask/"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>flask学习笔记<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/blog/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>个人博客<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/GodL9211/haigeBlog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索本站" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link active vp-sidebar-title" href="/docs/python/"><!---->python系列<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">python基础</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/python%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>学习路线<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E8%AE%A4%E8%AF%86python.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>认识python<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E5%AF%B9%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%80%E7%9F%A5%E5%8D%8A%E8%A7%A3%EF%BC%9F.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>对迭代器一知半解？<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E7%94%9F%E6%88%90%E5%99%A8%E6%98%AF%E4%BB%80%E4%B9%88.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>生成器是什么？<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>上下文管理器和with语句<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#什么是上下文管理器和with"><!---->什么是上下文管理器和with<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#一个典型的案例便是内置的open-函数"><!---->一个典型的案例便是内置的open()函数<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#另外一个典型的例子-是-python-中的-threading-lock-类。"><!---->另外一个典型的例子，是 Python 中的 threading.lock 类。<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#什么场景建议考虑使用上下文管理器和with语句"><!---->什么场景建议考虑使用上下文管理器和with语句<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#常见的上下文管理器和with语句使用"><!---->常见的上下文管理器和with语句使用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#上下文管理器和with的本质"><!---->上下文管理器和with的本质<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#上下文管理器的实现"><!---->上下文管理器的实现<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#with-语句"><!---->with 语句<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#异步上下文管理器和async-with的本质"><!---->异步上下文管理器和async with的本质<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#异步上下文管理器"><!---->异步上下文管理器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#使用asyc-with语句"><!---->使用asyc with语句<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#contextlib包简化上下文管理器的实现和管理"><!---->contextlib包简化上下文管理器的实现和管理<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#更多应用示例"><!---->更多应用示例<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#自定义文件上下文管理类"><!---->自定义文件上下文管理类<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#redis分布式锁"><!---->Redis分布式锁<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#redis事务和管道"><!---->Redis事务和管道<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#异步文件上下文管理器"><!---->异步文件上下文管理器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#异步http请求上下文管理器"><!---->异步HTTP请求上下文管理器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#django中的databaseerrorwrapper上下文管理器源码"><!---->django中的DatabaseErrorWrapper上下文管理器源码<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#总结"><!---->总结<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8Cwith%E8%AF%AD%E5%8F%A5.html#参考"><!---->参考<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E8%AF%A6%E8%A7%A3.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>多进程详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%AF%A6%E8%A7%A3.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>多线程详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/docs/python/python%E5%9F%BA%E7%A1%80/Python%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AF%A6%E8%A7%A3.html"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>装饰器详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">python进阶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">设计模式</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">django学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">flask学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">DRF学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">pandas学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">FastAPI学习笔记</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">优秀类库学习</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">爬虫</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">面试题</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/golang/"><!---->golang系列<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/interviews/"><!---->面试系列<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/%E5%89%8D%E7%AB%AF/"><!---->前端<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/linux/"><!---->linux<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/%E5%B7%A5%E5%85%B7%E7%AF%87/"><!---->工具推荐<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/git/"><!---->git教程<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/databases/"><!---->中间件系列<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/algorithms/"><!---->数据结构与算法<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/infrastructure/"><!---->系统设计<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/technical/"><!---->技术选型<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="vp-link nav-link vp-sidebar-title" href="/docs/%E8%87%AA%E5%AA%92%E4%BD%93%E5%89%AF%E4%B8%9A%E4%B9%8B%E8%B7%AF/"><!---->自媒体副业之路<!----></a><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>上下文管理器和with语句</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/GodL9211" target="_blank" rel="noopener noreferrer">Mr.暴走の海鸽</a></span><span property="author" content="Mr.暴走の海鸽"></span></span><!----><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-12-12T10:12:36.000Z"></span><!----><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 5193 字</span><meta property="wordCount" content="5193"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 17 分钟</span><meta property="timeRequired" content="PT17M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#什么是上下文管理器和with">什么是上下文管理器和with</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#一个典型的案例便是内置的open-函数">一个典型的案例便是内置的open()函数</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#另外一个典型的例子-是-python-中的-threading-lock-类。">另外一个典型的例子，是 Python 中的 threading.lock 类。</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#什么场景建议考虑使用上下文管理器和with语句">什么场景建议考虑使用上下文管理器和with语句</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#常见的上下文管理器和with语句使用">常见的上下文管理器和with语句使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#上下文管理器和with的本质">上下文管理器和with的本质</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#上下文管理器的实现">上下文管理器的实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#with-语句">with 语句</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#异步上下文管理器和async-with的本质">异步上下文管理器和async with的本质</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#异步上下文管理器">异步上下文管理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#使用asyc-with语句">使用asyc with语句</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#contextlib包简化上下文管理器的实现和管理">contextlib包简化上下文管理器的实现和管理</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#更多应用示例">更多应用示例</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#自定义文件上下文管理类">自定义文件上下文管理类</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#redis分布式锁">Redis分布式锁</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#redis事务和管道">Redis事务和管道</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#异步文件上下文管理器">异步文件上下文管理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#异步http请求上下文管理器">异步HTTP请求上下文管理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#django中的databaseerrorwrapper上下文管理器源码">django中的DatabaseErrorWrapper上下文管理器源码</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#总结">总结</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#参考">参考</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p>嗨，大家好，我是暴走的海鸽。</p><p>今天，我将向大家介绍上下文管理器和with语句的使用方法。</p><blockquote><p>以下<strong>上下文管理器</strong>、<strong>with</strong>未作特殊说明时均为同步原语。</p></blockquote><h2 id="什么是上下文管理器和with" tabindex="-1"><a class="header-anchor" href="#什么是上下文管理器和with" aria-hidden="true">#</a> 什么是上下文管理器和with</h2><p>有人认为Python中的with语句是一个晦涩难懂的特性，但是只要你了解了其背后的原理，就不会感觉到神秘了。with语句实际上是非常有用的特性，有助于编写清晰易读的Python代码。</p><p>而上下文管理器存在的目的便是管理with语句，就像迭代器的存在是为了管理for语句一样。</p><p>那么，究竟 with 语句要怎么用，与之相关的上下文管理器（context manager）是什么，它们之间又有着怎样的联系呢？</p><p>在任何一门编程语言中，<code>文件的输入输出</code>、<code>数据库的连接断开</code>等，都是很常见的资源管理操作。但资源都是有限的，在写程序时，我们必须保证这些资源在使用过后得到释放，不然就容易造成资源泄露，轻者使得系统处理缓慢，重则会使系统崩溃。</p><p>在 Python 中，上下文管理器（Context Manager）是一种资源管理的机制，用于在使用资源（如文件、网络连接、数据库连接等）之前分配资源，然后在使用完毕后释放资源。<code>with</code> 语句是用来简化上下文管理器的使用的语法糖，使代码更加清晰和简洁。</p><h3 id="一个典型的案例便是内置的open-函数" tabindex="-1"><a class="header-anchor" href="#一个典型的案例便是内置的open-函数" aria-hidden="true">#</a> 一个典型的案例便是内置的open()函数</h3><p>使用try/finally结构保证文件的最终关闭：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;test.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而，这一套固定模板较为冗长，还容易漏写，代码可读性也较差，因此我们一般更倾向于<code>with</code>语句。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;test.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span> 
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="另外一个典型的例子-是-python-中的-threading-lock-类。" tabindex="-1"><a class="header-anchor" href="#另外一个典型的例子-是-python-中的-threading-lock-类。" aria-hidden="true">#</a> 另外一个典型的例子，是 Python 中的 threading.lock 类。</h3><p>比如我想要获取一个锁，执行相应的操作，完成后再释放，那么代码就可以写成下面这样：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>some_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
some_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    some_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而对应的 with 语句，同样非常简洁：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>some_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> somelock<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="什么场景建议考虑使用上下文管理器和with语句" tabindex="-1"><a class="header-anchor" href="#什么场景建议考虑使用上下文管理器和with语句" aria-hidden="true">#</a> 什么场景建议考虑使用上下文管理器和with语句</h2><p>从前面的例子中可以看出，上下文管理器的常见用途是自动打开和关闭文件以及锁的申请和释放。</p><p>不过，你还可以在许多其他情况下使用上下文管理器，综合来看有以下几种场景：</p><p><strong>1) 打开-关闭</strong></p><ul><li>如果想自动打开和关闭资源，可以使用上下文管理器。</li><li>例如，可以使用上下文管理器打开一个套接字并关闭它。</li></ul><p><strong>2) 锁定-释放</strong></p><ul><li>上下文管理器可以帮助你更有效地管理对象的锁。它们允许你获取锁并自动释放锁。</li></ul><p><strong>3) 启动-停止</strong></p><ul><li>上下文管理器还能帮助您处理需要启动和停止阶段的场景。</li><li>例如，您可以使用上下文管理器启动计时器并自动停止。</li></ul><p><strong>4) 更改 - 重置</strong></p><ul><li><p>上下文管理器可以处理更改和重置场景。</p></li><li><p>例如，您的应用程序需要连接多个数据源。它有一个默认连接。<br> 要连接到另一个数据源：</p><ul><li>首先，使用上下文管理器将默认连接更改为新连接。</li><li>第二，使用新连接。</li><li>第三，完成新连接的操作后，将其重置回默认连接。</li></ul></li></ul><p><strong>5) 进入 - 退出</strong></p><ul><li>上下文管理器可以处理进入和退出的场景。</li></ul><h2 id="常见的上下文管理器和with语句使用" tabindex="-1"><a class="header-anchor" href="#常见的上下文管理器和with语句使用" aria-hidden="true">#</a> 常见的上下文管理器和with语句使用</h2><p>为了更充分地掌握和运用这一特性，一个较为有效的途径是深入研究该特性在各个广泛应用的场景中的实际运用。</p><p>上下文管理器和 <code>with</code> 语句在 Python 中的使用非常广泛，涵盖了许多不同的场景。以下是一些常见的上下文管理器和 <code>with</code> 语句的使用场景：</p><p>1.<strong>文件操作</strong>：<code>open()</code> 函数返回的文件对象就是一个上下文管理器，它负责文件的打开和关闭。<code>with open(&quot;file.txt&quot;, &quot;r&quot;) as file:</code> 就是一个典型的使用案例。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>2.<strong>数据库连接</strong>：在数据库操作中，使用 <code>with</code> 语句可以确保在使用完数据库连接后正确地关闭连接，防止资源泄漏。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> sqlite3

<span class="token keyword">with</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;mydatabase.db&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> connection<span class="token punctuation">:</span>
    cursor <span class="token operator">=</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM mytable&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.<strong>网络连接</strong>：类似于数据库连接，确保在网络连接使用完毕后关闭连接是良好的实践。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">&#39;https://www.example.com&#39;</span>

<span class="token comment"># 使用Session对象作为上下文管理器</span>
<span class="token keyword">with</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
    <span class="token comment"># 发起GET请求</span>
    response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

    <span class="token comment"># 在此处处理响应</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token comment"># 在退出上下文时，底层连接会被关闭</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.<strong>线程锁</strong>：<code>threading</code> 模块中的 <code>Lock</code> 对象可以作为上下文管理器，确保在使用完锁之后正确释放。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> threading

lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> lock<span class="token punctuation">:</span>
<span class="token comment"># 执行需要线程同步的代码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.<strong>文件锁</strong>：在多进程环境下，可以使用文件锁确保多个进程对同一文件的互斥访问。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fcntl

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    fcntl<span class="token punctuation">.</span>flock<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> fcntl<span class="token punctuation">.</span>LOCK_EX<span class="token punctuation">)</span>
    <span class="token comment"># 执行需要文件锁的代码</span>
    fcntl<span class="token punctuation">.</span>flock<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> fcntl<span class="token punctuation">.</span>LOCK_UN<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>6.<strong>时间测量</strong>：使用上下文管理器来测量代码块的执行时间。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">TimerContextManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        elapsed_time <span class="token operator">=</span> self<span class="token punctuation">.</span>end_time <span class="token operator">-</span> self<span class="token punctuation">.</span>start_time
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Code executed in </span><span class="token interpolation"><span class="token punctuation">{</span>elapsed_time<span class="token punctuation">}</span></span><span class="token string"> seconds&quot;</span></span><span class="token punctuation">)</span>


<span class="token keyword">with</span> TimerContextManager<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 执行需要测量时间的代码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.<strong>测试资源管理</strong>：在测试中，可以使用上下文管理器确保在测试开始和结束时正确地分配和释放资源。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">TestContextManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 在测试开始时分配资源</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 在测试结束时释放资源</span>


<span class="token keyword">with</span> TestContextManager<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> test<span class="token punctuation">:</span>
<span class="token comment"># 执行测试代码</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些只是很小的一部分示例，上下文管理器和 <code>with</code> 语句的使用可以根据具体的应用场景而变化。总体而言，它们是一种确保资源正确管理的强大方式，提高了代码的可读性和可维护性。</p><h2 id="上下文管理器和with的本质" tabindex="-1"><a class="header-anchor" href="#上下文管理器和with的本质" aria-hidden="true">#</a> 上下文管理器和with的本质</h2><p>上面我们了解了一些常见的上下文管理器和with的用法，有内置的上下文管理器和自定义的上下文管理器。可能你已经从中看出点端倪了，不过不妨让我们深入的了解下这一特性的本质。</p><h3 id="上下文管理器的实现" tabindex="-1"><a class="header-anchor" href="#上下文管理器的实现" aria-hidden="true">#</a> 上下文管理器的实现</h3><p>一个上下文管理器必须实现两个方法：<code>__enter__</code> 和 <code>__exit__</code>。</p><ul><li><code>__enter__(self)</code>：在进入 <code>with</code> 语句块时被调用，返回资源对象，该对象会被赋值给 <code>as</code> 后面的变量。</li><li><code>__exit__(self, exc_type, exc_value, traceback)</code>：在离开 <code>with</code> 语句块时被调用，用于资源的释放。如果 <code>with</code> 语句块中发生异常，异常的信息（异常类型（如ZeroDivisionError）、异常示例（如错误消息）、traceback对象）将作为参数传递给 <code>__exit__</code> 方法。如果<code>__exit__</code>方法返回None或者True之外的值，with块中任何异常都会向上冒泡。</li></ul><blockquote><p>try/finally语句中调用sys.exec_info()，得到的便是<code>__exit__</code>接收的三个参数。因此可以在<code>__exit__</code>中对异常进行处理。</p></blockquote><p>我们来看一个发生异常的例子，观察 <code>__exit__</code> 方法拿到的异常信息是怎样的：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">TestContext</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;__enter__&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exc_type:&quot;</span><span class="token punctuation">,</span> exc_type<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exc_value:&quot;</span><span class="token punctuation">,</span> exc_value<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exc_tb:&quot;</span><span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;__exit__&quot;</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> TestContext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token punctuation">:</span>
    <span class="token comment"># 这里会发生异常</span>
    a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;t: %s&#39;</span> <span class="token operator">%</span> t<span class="token punctuation">)</span>
    
<span class="token triple-quoted-string string">&quot;&quot;&quot;
__enter__
exc_type: &lt;class &#39;ZeroDivisionError&#39;&gt;
exc_value: division by zero
exc_tb: &lt;traceback object at 0x7fa1d2adfe40&gt;
__exit__
Traceback (most recent call last):
  File &quot;/mnt/d/jinzhuan/rss/tpl_hf.py&quot;, line 15, in &lt;module&gt;
    a = 1 / 0
ZeroDivisionError: division by zero
&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>可以在<code>__exit__</code>处理异常，这也是很多框架中用于消除大量<code>try/exception/finally</code>的手段之一，比如django中就有这样处理数据库操作异常时的代码，见文末源码。</p></blockquote><h3 id="with-语句" tabindex="-1"><a class="header-anchor" href="#with-语句" aria-hidden="true">#</a> <code>with</code> 语句</h3><p>直接调用<code>__enter__</code>和<code>__exit__</code>方法是使用上下文管理器的方式之一，但是<code>with</code> 语句是一种更加简洁的处理上下文管理器的方式。它的语法如下：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">with</span> expression <span class="token keyword">as</span> variable<span class="token punctuation">:</span>
    <span class="token comment"># code block</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>expression</code> 返回一个上下文管理器对象。</li><li><code>variable</code> 是一个变量，用于存储 <code>expression</code> 返回的上下文管理器对象。</li></ul><p>在 <code>with</code> 语句块中，上下文管理器的 <code>__enter__</code> 方法被调用，返回的对象赋值给 <code>variable</code>。当退出 <code>with</code> 语句块时，无论是正常退出还是因为异常，上下文管理器的 <code>__exit__</code> 方法都会被调用。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">TimerContextManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        elapsed_time <span class="token operator">=</span> self<span class="token punctuation">.</span>end_time <span class="token operator">-</span> self<span class="token punctuation">.</span>start_time
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Elapsed Time: </span><span class="token interpolation"><span class="token punctuation">{</span>elapsed_time<span class="token punctuation">}</span></span><span class="token string"> seconds&quot;</span></span><span class="token punctuation">)</span>


<span class="token keyword">with</span> TimerContextManager<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> timer<span class="token punctuation">:</span>
    <span class="token comment"># 在这里写你想要测量执行时间的代码</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token comment"># 在这里 timer 对象不再可用，执行时间已经在 __exit__ 方法中输出</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 <code>with</code> 语句可以确保资源的正确分配和释放，使代码更加简洁和可读。上下文管理器在文件操作、数据库连接、网络连接等场景中经常被使用。在 Python 标准库中，有一些内置的上下文管理器，比如 <code>open()</code> 函数返回的文件对象就是一个上下文管理器。</p><p><strong>python 3.10后支持带括号的上下文管理器</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">with</span><span class="token punctuation">(</span>  
   <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;text1.txt&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f1<span class="token punctuation">,</span>  
   <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;text2.txt&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f2  
<span class="token punctuation">)</span><span class="token punctuation">:</span>  
  <span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f2<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="异步上下文管理器和async-with的本质" tabindex="-1"><a class="header-anchor" href="#异步上下文管理器和async-with的本质" aria-hidden="true">#</a> <strong>异步上下文管理器</strong>和<strong>async with</strong>的本质</h2><h3 id="异步上下文管理器" tabindex="-1"><a class="header-anchor" href="#异步上下文管理器" aria-hidden="true">#</a> 异步上下文管理器</h3><p>要创建异步上下文管理器，您需要定义<code>.__aenter__()</code>和<code>.__aexit__()</code>方法。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> aiohttp
<span class="token keyword">import</span> asyncio


<span class="token keyword">class</span> <span class="token class-name">AsyncSession</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_url <span class="token operator">=</span> url

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__aenter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>session <span class="token operator">=</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> <span class="token keyword">await</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_url<span class="token punctuation">)</span>
        <span class="token keyword">return</span> response

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">__aexit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> AsyncSession<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">: status -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        html <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">: type -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>html<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>
        check<span class="token punctuation">(</span><span class="token string">&quot;https://realpython.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        check<span class="token punctuation">(</span><span class="token string">&quot;https://pycoders.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>


asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># https://realpython.com: status -&gt; 200</span>
<span class="token comment"># https://pycoders.com: status -&gt; 200</span>
<span class="token comment"># https://pycoders.com: type -&gt; &lt;!doctype html&gt;</span>
<span class="token comment"># https://realpython.com: type -&gt; &lt;!doctype html</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用asyc-with语句" tabindex="-1"><a class="header-anchor" href="#使用asyc-with语句" aria-hidden="true">#</a> 使用asyc with语句</h3><p><code>async with</code>是<code>with</code>语句的异步版本，可以使用它来编写依赖于异步代码的上下文管理器。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> aiohttp
<span class="token keyword">import</span> asyncio


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">: status -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            html <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span><span class="token string">: type -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>html<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>
        check<span class="token punctuation">(</span><span class="token string">&quot;https://realpython.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        check<span class="token punctuation">(</span><span class="token string">&quot;https://pycoders.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>


asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># https://realpython.com: status -&gt; 200</span>
<span class="token comment"># https://realpython.com: type -&gt; &lt;!doctype html</span>
<span class="token comment"># https://pycoders.com: status -&gt; 200</span>
<span class="token comment"># https://pycoders.com: type -&gt; &lt;!doctype html&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="contextlib包简化上下文管理器的实现和管理" tabindex="-1"><a class="header-anchor" href="#contextlib包简化上下文管理器的实现和管理" aria-hidden="true">#</a> <strong>contextlib包</strong>简化上下文管理器的实现和管理</h2><p><code>contextlib</code> 模块提供了一些实用工具，用于简化创建和操作上下文管理器。以下是一些常用的 <code>contextlib</code> 工具：</p><p>1.<strong><code>contextlib.contextmanager</code>：</strong></p><p><strong>介绍：</strong> 这是一个装饰器，用于将一个生成器函数转化为上下文管理器。生成器的 <code>yield</code> 语句之前的代码块将在 <code>__enter__</code> 方法中执行，而 <code>yield</code> 语句之后的代码块将在 <code>__exit__</code> 方法中执行。</p><p><strong>此装饰器本质：</strong> 我们先来看下这个装饰器的定义和帮助文档，其实讲的还是非常清楚的，巧妙的利用了<code>生成器</code>特性实现了上下文管理器。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">contextmanager</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">&quot;&quot;&quot;@contextmanager decorator.

  Typical usage:

      @contextmanager
      def some_generator(&lt;arguments&gt;):
          &lt;setup&gt;
          try:
              yield &lt;value&gt;
          finally:
              &lt;cleanup&gt;

  This makes this:

      with some_generator(&lt;arguments&gt;) as &lt;variable&gt;:
          &lt;body&gt;

  equivalent to this:

      &lt;setup&gt;
      try:
          &lt;variable&gt; = &lt;value&gt;
          &lt;body&gt;
      finally:
          &lt;cleanup&gt;
  &quot;&quot;&quot;</span>
  <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
  <span class="token keyword">def</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwds<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> _GeneratorContextManager<span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwds<span class="token punctuation">)</span>
  <span class="token keyword">return</span> helper
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>class _GeneratorContextManager(_GeneratorContextManagerBase,
                             AbstractContextManager,
                             ContextDecorator):
   &quot;&quot;&quot;Helper for @contextmanager decorator.&quot;&quot;&quot;

   def _recreate_cm(self):
       # _GCM instances are one-shot context managers, so the
       # CM must be recreated each time a decorated function is
       # called
       return self.__class__(self.func, self.args, self.kwds)

   def __enter__(self):
       # do not keep args and kwds alive unnecessarily
       # they are only needed for recreation, which is not possible anymore
       del self.args, self.kwds, self.func
       try:
           return next(self.gen)
       except StopIteration:
           raise RuntimeError(&quot;generator didn&#39;t yield&quot;) from None

   def __exit__(self, type, value, traceback):
       if type is None:
           try:
               next(self.gen)
           except StopIteration:
               return False
           else:
               raise RuntimeError(&quot;generator didn&#39;t stop&quot;)
       else:
           if value is None:
               # Need to force instantiation so we can reliably
               # tell if we get the same exception back
               value = type()
           try:
               self.gen.throw(type, value, traceback)
           except StopIteration as exc:
               # Suppress StopIteration *unless* it&#39;s the same exception that
               # was passed to throw().  This prevents a StopIteration
               # raised inside the &quot;with&quot; statement from being suppressed.
               return exc is not value
           except RuntimeError as exc:
               # Don&#39;t re-raise the passed in exception. (issue27122)
               if exc is value:
                   return False
               # Likewise, avoid suppressing if a StopIteration exception
               # was passed to throw() and later wrapped into a RuntimeError
               # (see PEP 479).
               if type is StopIteration and exc.__cause__ is value:
                   return False
               raise
           except:
               # only re-raise if it&#39;s *not* the exception that was
               # passed to throw(), because __exit__() must not raise
               # an exception unless __exit__() itself failed.  But throw()
               # has to raise the exception to signal propagation, so this
               # fixes the impedance mismatch between the throw() protocol
               # and the __exit__() protocol.
               #
               # This cannot use &#39;except BaseException as exc&#39; (as in the
               # async implementation) to maintain compatibility with
               # Python 2, where old-style class exceptions are not caught
               # by &#39;except BaseException&#39;.
               if sys.exc_info()[1] is value:
                   return False
               raise
           raise RuntimeError(&quot;generator didn&#39;t stop after throw()&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager


<span class="token decorator annotation punctuation">@contextmanager</span>
<span class="token keyword">def</span> <span class="token function">my_context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Code before yield is __enter__</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Enter&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span>
    <span class="token comment"># Code after yield is __exit__</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Exit&quot;</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> my_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Inside the context&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>yield后异常示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager


<span class="token decorator annotation punctuation">@contextmanager</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;before&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token string">&#39;hello&#39;</span>
        <span class="token comment"># 这里发生异常必须自己处理异常逻辑否则不会向下执行</span>
        a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;after&#39;</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    
<span class="token triple-quoted-string string">&quot;&quot;&quot;
before
hello
after
Traceback (most recent call last):
  File &quot;/mnt/d/jinzhuan/rss/tpl_hf.py&quot;, line 16, in &lt;module&gt;
    print(t)
  File &quot;/usr/lib/python3.8/contextlib.py&quot;, line 120, in __exit__
    next(self.gen)
  File &quot;/mnt/d/jinzhuan/rss/tpl_hf.py&quot;, line 10, in test
    a = 1 / 0
ZeroDivisionError: division by zero
&quot;&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.<strong><code>contextlib.closing</code>：</strong></p><p><strong>介绍：</strong> <code>closing</code> 是一个上下文管理器工具，用于确保在退出上下文时调用对象的<code>close</code>方法。通常，它用于处理那些没有实现上下文管理协议（<code>__enter__</code>和<code>__exit__</code>方法）的对象，但是有<code>close</code>方法的情况。</p><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing


<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># 定义了 close 方法才可以使用 closing 装饰器</span>
    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;closed&#39;</span><span class="token punctuation">)</span>

    <span class="token comment"># with 块执行结束后 自动执行 close 方法</span>


<span class="token keyword">with</span> closing<span class="token punctuation">(</span>Test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;do something&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># Output:  </span>
<span class="token comment"># do something  </span>
<span class="token comment"># closed</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从执行结果我们可以看到，<code>with</code> 语句块执行结束后，会自动调用 <code>Test</code> 实例的 <code>close</code> 方法。所以，对于需要自定义关闭资源的场景，我们可以使用这个方法配合 <code>with</code> 来完成。</p><p>3.<strong><code>contextlib.ExitStack</code>：</strong></p><p><strong>介绍：</strong> <code>ExitStack</code> 是一个上下文管理器，它允许你动态地管理一组上下文管理器，无论这组管理器的数量是多少。它可以用于替代多个嵌套的 <code>with</code> 语句。</p><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ExitStack


<span class="token keyword">def</span> <span class="token function">example_function</span><span class="token punctuation">(</span>file1_path<span class="token punctuation">,</span> file2_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> ExitStack<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stack<span class="token punctuation">:</span>
        <span class="token comment"># 打开第一个文件</span>
        file1 <span class="token operator">=</span> stack<span class="token punctuation">.</span>enter_context<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>file1_path<span class="token punctuation">,</span> <span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 打开第二个文件</span>
        file2 <span class="token operator">=</span> stack<span class="token punctuation">.</span>enter_context<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>file2_path<span class="token punctuation">,</span> <span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 在此处进行文件处理，无需手动关闭文件</span>


<span class="token comment"># 使用例子</span>
example_function<span class="token punctuation">(</span><span class="token string">&#39;file1.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;file2.txt&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.<strong><code>contextlib.suppress</code>：</strong></p><p><strong>介绍：</strong> <code>suppress</code> 是一个上下文管理器，用于<code>忽略指定的异常</code>。它允许您执行代码块，即使在存在异常的情况下也能继续执行。</p><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> suppress

<span class="token keyword">with</span> suppress<span class="token punctuation">(</span>ZeroDivisionError<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试执行可能抛出异常的代码</span>
    result <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>

<span class="token comment"># 不会中断程序执行，即使发生了ZeroDivisionError</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Continuing with the program&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.<strong><code>contextlib.redirect_stdout</code> 和 <code>contextlib.redirect_stderr</code>：</strong></p><p><strong>介绍：</strong> 这两个上下文管理器允许您在代码块内重定向标准输出和标准错误流。</p><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> redirect_stdout<span class="token punctuation">,</span> redirect_stderr
<span class="token keyword">import</span> io

<span class="token comment"># 示例1: 将标准输出重定向到文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;output.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">with</span> redirect_stdout<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;This goes to the file instead of the console.&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 示例2: 将标准错误重定向到字符串</span>
error_output <span class="token operator">=</span> io<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> redirect_stderr<span class="token punctuation">(</span>error_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;This goes to the error_output StringIO instead of the console.&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 获取重定向的标准错误的内容</span>
error_contents <span class="token operator">=</span> error_output<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Captured error output:&quot;</span><span class="token punctuation">,</span> error_contents<span class="token punctuation">)</span>

<span class="token comment"># This goes to the error_output StringIO instead of the console.</span>
<span class="token comment"># Captured error output:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>6.<strong><code>contextlib.ContextDecorator</code>：</strong></p><p><strong>介绍：</strong> <code>ContextDecorator</code>是一个用于创建同时兼具上下文管理器和装饰器功能的基类。</p><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> ContextDecorator


<span class="token keyword">class</span> <span class="token class-name">TestCm</span><span class="token punctuation">(</span>ContextDecorator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">12</span>

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;enter&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">)</span>
        TestCm<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">12</span>


<span class="token decorator annotation punctuation">@TestCm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">play_testcm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    TestCm<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">8</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;play_testcm, &quot;</span><span class="token punctuation">,</span> TestCm<span class="token punctuation">.</span>a<span class="token punctuation">)</span>


play_testcm<span class="token punctuation">(</span><span class="token punctuation">)</span>



<span class="token comment"># enter</span>
<span class="token comment"># play_testcm,  8</span>
<span class="token comment"># exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>7.<strong><code>contextlib.asynccontextmanager</code>：</strong></p><p><strong>介绍：</strong> <code>contextlib.asynccontextmanager</code>是用于创建<code>异步上下文管理器</code>的装饰器。</p><p><strong>示例：</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> asynccontextmanager


<span class="token comment"># 异步上下文管理器的例子</span>
<span class="token decorator annotation punctuation">@asynccontextmanager</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">async_example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Enter async_example&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 在进入上下文时执行一些异步操作</span>

    result <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># 将资源（或状态）传递给上下文</span>
        <span class="token keyword">yield</span> result
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token comment"># 在退出上下文时执行一些异步操作</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Exit async_example&quot;</span><span class="token punctuation">)</span>


<span class="token comment"># 使用异步上下文管理器</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> async_example<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> result<span class="token punctuation">:</span>
        <span class="token comment"># 在此处使用上下文中的资源</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Inside main:&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>


<span class="token comment"># 运行异步代码</span>
asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Enter async_example</span>
<span class="token comment"># Inside main: None</span>
<span class="token comment"># Exit async_example</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些工具使得使用上下文管理器更加方便和灵活。<code>contextlib</code> 是 Python 标准库中一个强大而灵活的模块，用于简化上下文管理器的使用。</p><p>关于<code>contextlib</code>包的更多使用技巧，请阅读源码或参考官方文档。</p><h2 id="更多应用示例" tabindex="-1"><a class="header-anchor" href="#更多应用示例" aria-hidden="true">#</a> 更多应用示例</h2><h3 id="自定义文件上下文管理类" tabindex="-1"><a class="header-anchor" href="#自定义文件上下文管理类" aria-hidden="true">#</a> 自定义文件上下文管理类</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FileManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;calling __init__ method&#39;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>mode <span class="token operator">=</span> mode 
        self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token boolean">None</span>
        
    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;calling __enter__ method&#39;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>mode<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">file</span>


    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;calling __exit__ method&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
<span class="token keyword">with</span> FileManager<span class="token punctuation">(</span><span class="token string">&#39;test.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;ready to write to file&#39;</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&#39;hello world&#39;</span><span class="token punctuation">)</span>
    
<span class="token comment">## 输出</span>
calling __init__ method
calling __enter__ method
ready to write to <span class="token builtin">file</span>
calling __exit__ method
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redis分布式锁" tabindex="-1"><a class="header-anchor" href="#redis分布式锁" aria-hidden="true">#</a> Redis分布式锁</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> redis
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager

<span class="token comment"># 假设已经创建了一个 Redis 连接</span>
redis_client <span class="token operator">=</span> redis<span class="token punctuation">.</span>StrictRedis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@contextmanager</span>
<span class="token keyword">def</span> <span class="token function">lock</span><span class="token punctuation">(</span>_redis_client<span class="token punctuation">,</span> lock_key<span class="token punctuation">,</span> expire<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        _locked <span class="token operator">=</span> _redis_client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> <span class="token string">&#39;locked&#39;</span><span class="token punctuation">,</span> ex<span class="token operator">=</span>expire<span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> _locked
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        _redis_client<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>lock_key<span class="token punctuation">)</span>


<span class="token comment"># 使用 lock 上下文管理器</span>
<span class="token keyword">with</span> lock<span class="token punctuation">(</span>redis_client<span class="token punctuation">,</span> <span class="token string">&#39;locked&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">as</span> locked<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> locked<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to acquire lock. Exiting...&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Lock acquired. Performing some operation...&quot;</span><span class="token punctuation">)</span>
        <span class="token comment"># 在这里执行需要锁的操作</span>

<span class="token comment"># do something...</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redis事务和管道" tabindex="-1"><a class="header-anchor" href="#redis事务和管道" aria-hidden="true">#</a> Redis事务和管道</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> redis
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager

<span class="token comment"># 假设已经创建了一个 Redis 连接</span>
redis_client <span class="token operator">=</span> redis<span class="token punctuation">.</span>StrictRedis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@contextmanager</span>
<span class="token keyword">def</span> <span class="token function">pipeline</span><span class="token punctuation">(</span>_redis_client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _pipe <span class="token operator">=</span> _redis_client<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> _pipe
        _pipe<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
        _pipe<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 使用 pipeline 上下文管理器</span>
<span class="token keyword">with</span> pipeline<span class="token punctuation">(</span>redis_client<span class="token punctuation">)</span> <span class="token keyword">as</span> pipe<span class="token punctuation">:</span>
    pipe<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&#39;key1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> ex<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    pipe<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">&#39;key2&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    pipe<span class="token punctuation">.</span>sadd<span class="token punctuation">(</span><span class="token string">&#39;key3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>让我简要解释一下这段代码：</p><ol><li><code>pipeline</code> 函数使用 <code>@contextmanager</code> 装饰器，使得该函数返回一个上下文管理器。</li><li>在 <code>try</code> 块内，创建了一个 Redis pipeline 对象 <code>pipe</code>。</li><li><code>yield pipe</code> 将这个 pipeline 对象传递给 <code>with</code> 语句中的 <code>as</code> 子句，这样在 <code>with</code> 代码块中可以使用这个 pipeline 对象。</li><li><code>pipe.execute()</code> 在 <code>with</code> 代码块结束时被调用，执行 Redis pipeline 中的所有命令。</li><li><code>except</code> 块内，如果在 <code>with</code> 代码块中发生了异常，通过 <code>pipe.reset()</code> 重置 pipeline 对象，确保不会执行之前的命令。</li></ol><h3 id="异步文件上下文管理器" tabindex="-1"><a class="header-anchor" href="#异步文件上下文管理器" aria-hidden="true">#</a> 异步文件上下文管理器</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> aiofiles
<span class="token keyword">import</span> asyncio


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_file_async</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> aiofiles<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        content <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>read_file_async<span class="token punctuation">(</span><span class="token string">&#39;example.txt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="异步http请求上下文管理器" tabindex="-1"><a class="header-anchor" href="#异步http请求上下文管理器" aria-hidden="true">#</a> 异步HTTP请求上下文管理器</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> aiohttp
<span class="token keyword">import</span> asyncio


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">fetch_data</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>
            data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>fetch_data<span class="token punctuation">(</span><span class="token string">&#39;https://baidu.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="django中的databaseerrorwrapper上下文管理器源码" tabindex="-1"><a class="header-anchor" href="#django中的databaseerrorwrapper上下文管理器源码" aria-hidden="true">#</a> django中的DatabaseErrorWrapper上下文管理器源码</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DatabaseErrorWrapper</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Context manager and decorator that reraises backend-specific database
    exceptions using Django&#39;s common wrappers.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> wrapper<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        wrapper is a database wrapper.

        It must have a Database attribute defining PEP-249 exceptions.
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>wrapper <span class="token operator">=</span> wrapper

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> exc_type <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">for</span> dj_exc_type <span class="token keyword">in</span> <span class="token punctuation">(</span>
                DataError<span class="token punctuation">,</span>
                OperationalError<span class="token punctuation">,</span>
                IntegrityError<span class="token punctuation">,</span>
                InternalError<span class="token punctuation">,</span>
                ProgrammingError<span class="token punctuation">,</span>
                NotSupportedError<span class="token punctuation">,</span>
                DatabaseError<span class="token punctuation">,</span>
                InterfaceError<span class="token punctuation">,</span>
                Error<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">:</span>
            db_exc_type <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>Database<span class="token punctuation">,</span> dj_exc_type<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">issubclass</span><span class="token punctuation">(</span>exc_type<span class="token punctuation">,</span> db_exc_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
                dj_exc_value <span class="token operator">=</span> dj_exc_type<span class="token punctuation">(</span><span class="token operator">*</span>exc_value<span class="token punctuation">.</span>args<span class="token punctuation">)</span>
                <span class="token comment"># Only set the &#39;errors_occurred&#39; flag for errors that may make</span>
                <span class="token comment"># the connection unusable.</span>
                <span class="token keyword">if</span> dj_exc_type <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>DataError<span class="token punctuation">,</span> IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>errors_occurred <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">raise</span> dj_exc_value<span class="token punctuation">.</span>with_traceback<span class="token punctuation">(</span>traceback<span class="token punctuation">)</span> <span class="token keyword">from</span> exc_value

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Note that we are intentionally not using @wraps here for performance</span>
        <span class="token comment"># reasons. Refs #21109.</span>
        <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> self<span class="token punctuation">:</span>
                <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> inner
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>这篇文章深入探讨了 Python 上下文管理器的应用与实现。首先，我们对比了在没有使用 <code>with</code> 语句和使用 <code>with</code> 语句时操作文件的代码差异，明确了 <code>with</code> 语句的优势，使代码结构更为简洁。接着，我们深入研究了 <code>with</code> 语句的实现原理，强调只需实现 <code>__enter__</code> 和 <code>__exit__</code> 方法的实例，即可借助 <code>with</code> 语法块高效管理资源。</p><p>然后我们也简单了解了下<code>异步上下文管理器</code>和<code>async with</code>以管理资源。</p><p>进一步介绍了 Python 标准库中 <code>contextlib</code> 模块，它提供了更便捷的上下文管理器实现方式。我们学习了如何使用 <code>contextmanager</code> 、<code>ContextDecorator</code>装饰器和 <code>closing</code> 等方法来优雅地处理资源。最后，通过多个实际例子展示了上下文管理器在管理资源和执行前后逻辑方面的价值。</p><p>综上所述，通过在开发中广泛运用上下文管理器，我们能够显著提升代码结构和可维护性。因此，强烈推荐在项目中积极采用这一优秀的编程模式。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><blockquote><p>《流畅的python》第一版及第二版<br> 《深入理解python特性》<br><a href="https://docs.python.org/3/library/contextlib.html" target="_blank" rel="noopener noreferrer">https://docs.python.org/3/library/contextlib.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br><a href="https://realpython.com/python-with-statement/" target="_blank" rel="noopener noreferrer">https://realpython.com/python-with-statement/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br><a href="https://medium.com/@praba230890/a-guide-to-python-context-managers-aa7db1d28e87" target="_blank" rel="noopener noreferrer">https://medium.com/@praba230890/a-guide-to-python-context-managers-aa7db1d28e87<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br><a href="https://book.pythontips.com/en/latest/context_managers.html" target="_blank" rel="noopener noreferrer">https://book.pythontips.com/en/latest/context_managers.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><blockquote><p>喜欢这篇文章的话，可以关注一下我的公众号『<strong>海哥python</strong>』</p></blockquote></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/GodL9211/haigeBlog/edit/main/src/docs/python/python基础/上下文管理器和with语句.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: lianhaifeng@rongannetworks.com">lianhaifeng</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="vp-link nav-link prev" href="/docs/python/python%E5%9F%BA%E7%A1%80/%E7%94%9F%E6%88%90%E5%99%A8%E6%98%AF%E4%BB%80%E4%B9%88.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>生成器是什么？</div></a><a class="vp-link nav-link next" href="/docs/python/python%E5%9F%BA%E7%A1%80/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E8%AF%A6%E8%A7%A3.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">多进程详解<span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">暴走の海鸽</div><div class="vp-copyright">Copyright © 2024 Mr.暴走の海鸽</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-967d79b2.js" defer></script>
  </body>
</html>
